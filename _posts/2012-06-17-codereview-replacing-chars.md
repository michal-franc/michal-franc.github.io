---
layout: post
title: Codereview – Replacing chars
date: 2012-06-17 17:54
author: Michal Franc

comments: true
categories: [codereview, Uncategorized]
---
<p align="justify">One of my friends asked me for help with his code. He had a simple error with <strong>IndexOutOfBound </strong>exception, it was quite simple but I had other suggestion to his code.&nbsp; Hopefully this post will help other <strong>“starting”</strong> programmers by providing good tips and some ideas relating the code and refactorization.</p> <h2 align="justify">Initial Code</h2> <p align="justify"><a href="http://www.mfranc.com/wp-content/uploads/2012/06/image.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto; padding-top: 0px" title="image" border="0" alt="image" src="http://www.mfranc.com/wp-content/uploads/2012/06/image_thumb.png" width="505" height="382"></a></p> <p align="justify">Here is the code. This method takes <strong>string</strong> as a parameter and returns another <strong>string</strong>. It is not obvious but this function is supposed to change Polish characters to other chars in order to clean up provided parameter.</p> <h5 align="justify">Simple Example</h5> <p align="justify">For input <strong>“żenił Jak może budować”</strong> this function should return<strong> “zenil Jak moze budowac”</strong></p> <p align="justify">As you can see we get rid of <strong>“ż ć ł”.</strong></p> <h5 align="justify">Error</h5> <p align="justify">There is a very simple error inside this code that gives <strong>IndexOutOfBound Exception</strong> for some cases. Code works when lengths of strings in <strong>array</strong> , <strong>array2</strong> and parameter string <strong>“str”</strong> are the same. It is clearly a problem linked with two <strong>for loops</strong> and their stop conditions.</p> <h2 align="justify">Fix in the Code</h2> <h2 align="justify"><a href="http://www.mfranc.com/wp-content/uploads/2012/06/image1.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto; padding-top: 0px" title="image" border="0" alt="image" src="http://www.mfranc.com/wp-content/uploads/2012/06/image_thumb1.png" width="495" height="401"></a></h2> <p align="justify">Fix is simple and involves changes to the stop conditions inside loops. Outer loops should be dependent on length from array being changed. Inner loops is iterating through elements inside arrays that are defining char – replacer relationship.&nbsp; </p> <p align="justify">After those fixes function works fine and does the required job.</p> <h2 align="justify">Refactorization</h2> <p align="justify">After fixing the bug let’s talk about quality of the code, conventions and refactorization. </p> <p align="justify">First of all I don’t like the name of the function - <strong>“replace_pl” </strong>, this one doesn’t fit into standard <strong>camel case </strong>convention in <strong>.Net, a</strong>lso this name gives us little information about purpose of the function. Only clear message is that it replaces something, we don’t know what kind of thing. I changed the name to <strong>ReplacePolishChars, </strong>a lot better and quite descriptive.</p> <p align="justify">Then I changed the parameter name and name of the object that will be returned to <strong>”inputString”</strong> and <strong>“outputString”</strong> . With names containing&nbsp; <strong>input</strong> and <strong>output, </strong>I can easily track variables that are visible to the user of the method.</p> <p align="justify">Internal variables <strong>array</strong> and <strong>array2,</strong> that’s also a bad idea. From their names we don’t know what’s their usage and purpose. We need to analyze code in order to get the general idea what are they. I changed their names to <strong>“polishChars” </strong>and<strong> “replacers”</strong> now we know&nbsp; (I don’t like the idea of two strings here but I will get back to this later ) .</p> <p align="justify">&nbsp;</p> <p align="justify"><a href="http://www.mfranc.com/wp-content/uploads/2012/06/image2.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto; padding-top: 0px" title="image" border="0" alt="image" src="http://www.mfranc.com/wp-content/uploads/2012/06/image_thumb2.png" width="514" height="359"></a></p> <p align="justify"></p> <p align="justify">&nbsp;</p> <p align="justify">This code can be refactored further. Instead of <strong>“==” </strong>operator we could use <strong>.Equals</strong> or <strong>Compare. For</strong> loops could be replaced with <strong>enumarator</strong> and <strong>foreach.</strong></p> <h2 align="justify">Better Approach</h2> <p align="justify">I mentioned earlier that I don’t like the idea with two <strong>strings</strong> containing data about chars being replaced and their replacers. With string you have to remember correct order, little change can cause painful and&nbsp; <strong>“hidden” </strong>bugs. It is also hard to track which pair of <strong>char </strong>and its <strong>replacer</strong>.</p> <p align="justify">It is better to use <strong>Dictionary</strong> with key equal to char being replaced and value equal to his replacer. With this solution we can delete one for loop and just check for each char in <strong>“inputString”</strong> if there is a key for it, and if it is just replace current char with value from the <strong>Dictionary</strong>.</p> <p align="justify">&nbsp;</p> <p align="justify"><a href="http://www.mfranc.com/wp-content/uploads/2012/06/image3.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto; padding-top: 0px" title="image" border="0" alt="image" src="http://www.mfranc.com/wp-content/uploads/2012/06/image_thumb3.png" width="510" height="413"></a></p> <p align="justify"></p> <p align="justify"></p> <p align="justify"></p> <p align="justify">&nbsp;</p> <p align="justify">With dictionary we can easily add new chars to be replaced, also it is a lot easier to track which char is replacing another one <img style="border-bottom-style: none; border-left-style: none; border-top-style: none; border-right-style: none" class="wlEmoticon wlEmoticon-winkingsmile" alt="Winking smile" src="http://www.mfranc.com/wp-content/uploads/2012/06/wlEmoticon-winkingsmile.png"></p> <h2 align="justify">Conclusion</h2> <p align="justify">Remember about the standards and conventions. Name your methods and variables accordingly retain nice descriptive style without using the comments. Commenting should be only used in special cases.&nbsp; Try to find different approaches and it is always good idea to <strong>code review </strong>your creations . Fresh pair of eyes is always helpful.</p>

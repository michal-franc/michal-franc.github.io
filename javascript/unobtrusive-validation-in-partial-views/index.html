<!DOCTYPE html>
<html>
    <head>

    
    <meta name="robots" content="all">
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Michal Franc">
    <meta name="keywords" content="michal franc,leader,programmer,coach,speaker">
	<title>Unobtrusive validation - Partial View | Michal Franc</title>
	<meta name="description" content="TL;DR;">

    <link href="https://fonts.googleapis.com/css?family=Inconsolata:700|Raleway" rel="stylesheet">
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="author" href="https://plus.google.com/104238159697387202725?rel=author">

	<link rel="canonical" href="http://www.mfranc.com/javascript/unobtrusive-validation-in-partial-views/">

    <link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" type="text/css" href="/css/sm.css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Michal Franc | Feed" href="http://feeds.feedburner.com/PassionateProgram">

    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="Unobtrusive validation - Partial View | Michal Franc">
    <meta property="og:description" content="TL;DR;">
	<meta property="og:url" content="http://www.mfranc.com/javascript/unobtrusive-validation-in-partial-views/">
    <meta property="og:site_name" content="Michal Franc Blog">
    <meta property="og:type" content="website">
	<meta property="og:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

	<meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Unobtrusive validation - Partial View | Michal Franc">
    <meta name="twitter:site" content="@francmichal">
    <meta name="twitter:creator" content="@francmichal">
    <meta name="twitter:description" content="TL;DR;">
	<meta name="twitter:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-15894596-3', 'auto');
  ga('send', 'pageview');
</script>

    <script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100563098); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100563098ns.gif" /></p></noscript>

    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

    <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1817837425153843'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1817837425153843&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->


  </head>


  <body>
    <main>
      <header class="site-header">
  <div class="container">
	  <h1><a href="/">Michal<span>Franc</span></a></h1>

    <button type="button" class="sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="navbar sliding-panel-content">
      <ul>
        
          <li><a href="/blog" title="Posts">Posts</a></li>
        
          <li><a href="/notes" title="Notes">Notes</a></li>
        
          <li><a href="/articles" title="Articles">Articles</a></li>
        
          <li><a href="/about" title="About">About</a></li>
        
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="sliding-panel-fade-screen"></div>


      <div class="container">
        <article role="article" class="post">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">Unobtrusive validation - Partial View</h1>
      <p class="post-meta">Jul 4, 2011 • Michal Franc - 
		<small>
			<i class="icon icon-comments"></i><span class="disqus-comment-count" data-disqus-url="http://mfranc.com/javascript/unobtrusive-validation-in-partial-views/"></span>
		</small>
		<small>
			
		</small>
	  </p>
    </header>

	<center>
		
	</center>

    <div class="post-content">
      
      <p><strong>TL;DR;</strong></p>

<h2>Solution</h2>
<p>And here is the final solution. simple plugin to jQuery.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="p">(</span><span class="nf">function</span> <span class="p">(</span><span class="err">$</span><span class="p">)</span> <span class="p">{</span> 
    <span class="err">$</span><span class="p">.</span><span class="n">validator</span><span class="p">.</span><span class="n">unobtrusive</span><span class="p">.</span><span class="n">addValidation</span> <span class="p">=</span> <span class="nf">function</span> <span class="p">(</span><span class="n">selector</span><span class="p">)</span> <span class="p">{</span> 
    <span class="c1">//get the relevant form 
</span>    <span class="kt">var</span> <span class="n">form</span> <span class="p">=</span> <span class="err">$</span><span class="p">(</span><span class="n">selector</span><span class="p">);</span> 
    <span class="c1">// delete validator in case someone called form.validate()
</span>    <span class="err">$</span><span class="p">(</span><span class="n">form</span><span class="p">).</span><span class="nf">removeData</span><span class="p">(</span><span class="s">"validator"</span><span class="p">);</span> 
    <span class="err">$</span><span class="p">.</span><span class="n">validator</span><span class="p">.</span><span class="n">unobtrusive</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">form</span><span class="p">);</span> 
  <span class="p">}</span></code></pre>
</figure>

<h2>Usage</h2>
<p>On the partial view use</p>

<h2>Explanation - Unobtrusive validation in partial view</h2>
<p align="justify">Unobtrusive validation is a great feature. You can easily bind your server side validation to client side validation provided by JQuery plugin.</p>
<p align="justify">Everything is fine but there is a small problem. When working with Partial views with form you need to load unobtrusive validation two times. First on when the main window is loaded and then the second time when the partial view is injected. Why ? Unobtrusive validation attaches special attributes to field on load event, which are used to bind your own rules defined inside the model with rules implementation provided by JQuery library.</p>
<p align="justify">When you create a partial view  fields in new form are without those special attributes and so validation is not working.</p>
<p align="justify">One of the solution is to load unobtrusive .js file again. It works but you need to load something twice wasting resources.</p>
<p>Let’s find a better solution.</p>
<h2>Scenario 1 - dynamic elements</h2>
<p>Some googling / binging and <a href="http://xhalent.wordpress.com/2011/01/24/applying-unobtrusive-validation-to-dynamic-content/">I found this post</a></p>

<p>This solution is ok if you are adding dynamic element to a form with already attached validation attributes .</p>
<p align="justify">In my scenario with dynamic data in partial, I am creating new form waiting to be validated. So let’s look at the next solution.</p>

<h2>Scenario 2 - new form (in partial view)</h2>

<p align="justify">After a lot of research  and debugging through the jQuery and MS validation plugin (at least I know in details how unobtrusive validation works ) . I noticed that unobtrusive creates special OnError method and overrides the default one ( which  injects default label ) in the jQuery</p>

<h3>Unobtrusive</h3>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp">    <span class="n">function</span> <span class="nf">onError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">inputElement</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// 'this' is the form element
</span>        <span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="err">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">find</span><span class="p">(</span><span class="s">"[data-valmsg-for='"</span> <span class="p">+</span> <span class="n">inputElement</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">name</span> <span class="p">+</span> <span class="s">"']"</span><span class="p">),</span>
            <span class="n">replace</span> <span class="p">=</span> <span class="err">$</span><span class="p">.</span><span class="nf">parseJSON</span><span class="p">(</span><span class="n">container</span><span class="p">.</span><span class="nf">attr</span><span class="p">(</span><span class="s">"data-valmsg-replace"</span><span class="p">))</span> <span class="p">!==</span> <span class="k">false</span><span class="p">;</span>

        <span class="n">container</span><span class="p">.</span><span class="nf">removeClass</span><span class="p">(</span><span class="s">"field-validation-valid"</span><span class="p">).</span><span class="nf">addClass</span><span class="p">(</span><span class="s">"field-validation-error"</span><span class="p">);</span>
        <span class="n">error</span><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="s">"unobtrusiveContainer"</span><span class="p">,</span> <span class="n">container</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">replace</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">container</span><span class="p">.</span><span class="nf">empty</span><span class="p">();</span>
            <span class="n">error</span><span class="p">.</span><span class="nf">removeClass</span><span class="p">(</span><span class="s">"input-validation-error"</span><span class="p">).</span><span class="nf">appendTo</span><span class="p">(</span><span class="n">container</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">error</span><span class="p">.</span><span class="nf">hide</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre>
</figure>

<p>Creating proxy with <strong>onError </strong>:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp">        <span class="k">if</span> <span class="p">(!</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">result</span> <span class="p">=</span> <span class="p">{</span>
                <span class="n">options</span><span class="p">:</span> <span class="p">{</span>  <span class="c1">// options structure passed to jQuery Validate's validate() method
</span>                    <span class="n">errorClass</span><span class="p">:</span> <span class="s">"input-validation-error"</span><span class="p">,</span>
                    <span class="n">errorElement</span><span class="p">:</span> <span class="s">"span"</span><span class="p">,</span>
                    <span class="n">errorPlacement</span><span class="p">:</span> <span class="err">$</span><span class="p">.</span><span class="nf">proxy</span><span class="p">(</span><span class="n">onError</span><span class="p">,</span> <span class="n">form</span><span class="p">),</span>
                    <span class="n">invalidHandler</span><span class="p">:</span> <span class="err">$</span><span class="p">.</span><span class="nf">proxy</span><span class="p">(</span><span class="n">onErrors</span><span class="p">,</span> <span class="n">form</span><span class="p">),</span>
                    <span class="n">messages</span><span class="p">:</span> <span class="p">{},</span>
                    <span class="n">rules</span><span class="p">:</span> <span class="p">{},</span>
                    <span class="n">success</span><span class="p">:</span> <span class="err">$</span><span class="p">.</span><span class="nf">proxy</span><span class="p">(</span><span class="n">onSuccess</span><span class="p">,</span> <span class="n">form</span><span class="p">)</span>
                <span class="p">},</span>
                <span class="n">attachValidation</span><span class="p">:</span> <span class="nf">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="err">$</span><span class="n">form</span><span class="p">.</span><span class="nf">validate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">options</span><span class="p">);</span>
                <span class="p">},</span>
                <span class="n">validate</span><span class="p">:</span> <span class="nf">function</span> <span class="p">()</span> <span class="p">{</span>  <span class="c1">// a validation function that is called by unobtrusive Ajax
</span>                    <span class="err">$</span><span class="n">form</span><span class="p">.</span><span class="nf">validate</span><span class="p">();</span>
                    <span class="k">return</span> <span class="err">$</span><span class="n">form</span><span class="p">.</span><span class="nf">valid</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">};</span>
            <span class="err">$</span><span class="n">form</span><span class="p">.</span><span class="nf">data</span><span class="p">(</span><span class="n">data_validation</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span></code></pre>
</figure>

<p align="justify">There is a method <strong>“parse”</strong> in unobtrusive plugin , which is responsible for creating validation attributes , adapters and also what’s really important <strong>errorPlacement</strong> adapter. Everything you need. Knowing all of this we can just use this <strong>“parse” </strong>on the form and everything should work fine.</p>

<p align="justify">Well there is a small problem. This won’t work because after a bit of analysis,I found that you can create validation rules once (correctly , without reloading whole script file ). Second and Third try won’t do anything. There will be problems with error placement or validation messages won’t show at all.</p>

<p align="justify">It seems that cached values are used. And it doesn’t matter if there are two different forms this behavior is global. Developers assumed that page should have only one form.&lt;/p?

So how to fix this ?

<strong>Delete validator data.</strong>
</p>

      <span id="post-end"></span>
    </div>

    <div id="mc_embed_signup">
<form action="https://mfranc.us13.list-manage.com/subscribe/post?u=8a5865e28c59044d419ecbe95&amp;id=d545f31150" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">If you are interested in Cloud Native, Scalability, System Design and more meaty side of Engineering at Scale. Then subscribe to my mailing list.</label>
      <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8a5865e28c59044d419ecbe95_d545f31150" tabindex="-1" value=""></div>
        <div class="clear">
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
        </div>
    </div>
</form>
</div>



    
<hr>

<aside id="comments" class="disqus">
  <div class="container">
    <h3><i class="icon icon-comments-o"></i> Comments</h3>
    <div id="disqus_thread"></div>
    <script>
      (function() {
        var d = document,
        s = d.createElement('script');
        s.src = '//thesilenceofthelams.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</aside>



  </div>

</article>

      </div>


      <footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="http://github.com/michal-franc" target="_blank"><i class="icon icon-github"></i></a></li>
  <li><a href="http://twitter.com/francmichal" target="_blank"><i class="icon icon-twitter"></i></a></li>
  <li><a href="http://facebook.com/michalfrancblog" target="_blank"><i class="icon icon-facebook"></i></a></li>
  <li><a href="https://uk.linkedin.com/in/michalfranc1" target="_blank"><i class="icon icon-linkedin"></i></a></li>
</ul>

    <p class="txt-medium-gray">
      <small>&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


      <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.slick-modals.js"/></script>

	  <!-- <script id="ulp-remote" src="http://tools.mfranc.com/wp-content/plugins/layered-popups/js/remote.min.js?ver=5.89" data-handler="http://tools.mfranc.com/wp-admin/admin-ajax.php"></script>
	  <script>

		    (function ($) {
			"use strict";
			var objectPositionTop = $('#post-end').offset().top - window.innerHeight;

				ulp_add_event("onexit", {
					popup:		"4AXWiVSrZD71uqiP",
					mode:		"once-period",
					period:		30
				});

				ulp_add_event("onidle", {
					popup:		"85oltSbndJGZQzaW",
					mode:		"once-period",
					period:         30
				});

				ulp_add_event("onscroll", {
					popup:		"INyhHrwTzxjvcqEb",
					mode:		"once-period",
					period:         30,
					offset:		objectPositionTop / 2
				});

		    }(jQuery));

    </script> -->

		<script id="dsq-count-scr" src="//thesilenceofthelams.disqus.com/count.js" async></script>

		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.7&appId=125980610784627";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
    </main>
  </body>
</html>

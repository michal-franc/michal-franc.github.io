<!DOCTYPE html>
<html>
    <head>

    
    <meta name="robots" content="all">
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Michal Franc">
    <meta name="keywords" content="michal franc,leader,programmer,coach,speaker">
	<title>TDD – commit by commit String Calculator Kata (IV) | Michal Franc</title>
	<meta name="description" content="Previous part in the series TDD – commit by commit String Calculator Kata (III) Last time I finished on negative values requirement. This will be the “almost...">

    <link href="https://fonts.googleapis.com/css?family=Inconsolata:700|Raleway" rel="stylesheet">
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="author" href="https://plus.google.com/104238159697387202725?rel=author">

	<link rel="canonical" href="http://www.mfranc.com/tdd/tdd-commit-by-commit-string-calculator-kata-iv/">

    <link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" type="text/css" href="/css/sm.css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Michal Franc | Feed" href="http://feeds.feedburner.com/PassionateProgram">

    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="TDD – commit by commit String Calculator Kata (IV) | Michal Franc">
    <meta property="og:description" content="Previous part in the series TDD – commit by commit String Calculator Kata (III) Last time I finished on negative values requirement. This will be the “almost...">
	<meta property="og:url" content="http://www.mfranc.com/tdd/tdd-commit-by-commit-string-calculator-kata-iv/">
    <meta property="og:site_name" content="Michal Franc Blog">
    <meta property="og:type" content="website">
	<meta property="og:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

	<meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="TDD – commit by commit String Calculator Kata (IV) | Michal Franc">
    <meta name="twitter:site" content="@francmichal">
    <meta name="twitter:creator" content="@francmichal">
    <meta name="twitter:description" content="Previous part in the series TDD – commit by commit String Calculator Kata (III) Last time I finished on negative values requirement. This will be the “almost...">
	<meta name="twitter:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-15894596-3', 'auto');
  ga('send', 'pageview');
</script>

    <script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100563098); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100563098ns.gif" /></p></noscript>

    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

    <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1817837425153843'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1817837425153843&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->


  </head>


  <body>
    <main>
      <header class="site-header">
  <div class="container">
	  <h1><a href="/">Michal<span>Franc</span></a></h1>

    <button type="button" class="sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="navbar sliding-panel-content">
      <ul>
        
          <li><a href="/blog" title="Posts">Posts</a></li>
        
          <li><a href="/notes" title="Notes">Notes</a></li>
        
          <li><a href="/articles" title="Articles">Articles</a></li>
        
          <li><a href="/about" title="About">About</a></li>
        
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="sliding-panel-fade-screen"></div>


      <div class="container">
        <article role="article" class="post">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">TDD – commit by commit String Calculator Kata (IV)</h1>
      <p class="post-meta">May 28, 2014 • Michal Franc - 
		<small>
			<i class="icon icon-comments"></i><span class="disqus-comment-count" data-disqus-url="http://mfranc.com/tdd/tdd-commit-by-commit-string-calculator-kata-iv/"></span>
		</small>
		<small>
			
			<a class="tag-badge" href="/blog/tags/#tdd">tdd</a>
			
		</small>
	  </p>
    </header>

	<center>
		
	</center>

    <div class="post-content">
      
      <p>Previous part in the series <a href="http://www.mfranc.com/tdd/tdd-commit-by-commit-string-calculator-kata-iii/">TDD – commit by commit String Calculator Kata (III)</a> Last time I finished on negative values requirement. This will be the “almost” last part of the series about String Calculator Kata. There was some interest in more practical TDD examples in business context with services, layers, mocks and external dependencies like database. I will start next series to cover scenarios like that. Current kata is quite simple and was just a start.</p>

<h3>Step - Ignore numbers greater or equal to 1000</h3>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Sum_ignores_number_greater_than_1000</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">calculator</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringCalculator</span><span class="p">();</span>
    <span class="kt">var</span> <span class="k">value</span> <span class="p">=</span> <span class="s">"1,2000,1000,1003"</span><span class="p">;</span>

    <span class="kt">var</span> <span class="n">actual</span> <span class="p">=</span> <span class="n">calculator</span><span class="p">.</span><span class="nf">SumFromString</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">expected</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>

    <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="nf">EqualTo</span><span class="p">(</span><span class="n">expected</span><span class="p">));</span>
<span class="p">}</span></code></pre>
</figure>

<p>I am expecting 1 here, all the other values are above 1000.</p>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/0bfd7712708ae01dd3dc5eb74fe87c0cc40e7524">Commit - Test</a><br />
Based on changes from previous steps, I can just use .Where() clause to filter out the values.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"> <span class="n">x</span> <span class="p">&lt;</span> <span class="m">1000</span><span class="p">).</span><span class="nf">Sum</span><span class="p">();</span></code></pre>
</figure>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/90640c798257cecd6ea6814a85b48f73e914a659">Commit - Implementation</a></p>

<h3>Step - Support for delimiters with any length Delimiters can be of any length with the following format</h3>

<p><strong>”//;;;\n”</strong>. Based on this input delimiter would be ‘;;;’, of course previous requirements are still supported.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">MultiCharDelimeter_Is_Supported</span><span class="p">()</span>
<span class="p">{</span>
     <span class="kt">var</span> <span class="n">calculator</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringCalculator</span><span class="p">();</span>
     <span class="kt">var</span> <span class="k">value</span> <span class="p">=</span> <span class="s">"//;;;\n1;;;2;;;3;;;4"</span><span class="p">;</span>

     <span class="kt">var</span> <span class="n">actual</span> <span class="p">=</span> <span class="n">calculator</span><span class="p">.</span><span class="nf">Sum</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>

     <span class="kt">var</span> <span class="n">expected</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>

     <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="nf">EqualTo</span><span class="p">(</span><span class="n">expected</span><span class="p">));</span>
<span class="p">}</span></code></pre>
</figure>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/60695c28ed128c31402622510fd75287d6c268e0">Commit - Test</a><br />
There are two options. I can either use brute force customised index based parsing, or I can use Regular expression. I know that if you have a problem and solve it with regexp, you suddenly have two problems :) Still I think that regexp should be fine in here.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="p">.*)</span><span class="err">"</span><span class="p">,</span> <span class="n">RegexOptions</span><span class="p">.</span><span class="n">Compiled</span><span class="p">);</span></code></pre>
</figure>

<p>This regexp matches two groups ‘delimiter’ and ‘value’. I need ‘value’ to extract the string with all the values. As an examples, given “//;;;\n1;;;2;;;3;;;4” delimiter - ;;; value -1;;;2;;;3;;;4 With this solution I will remove substring based extraction which was not that good.</p>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/ffe6520929658973a8bec7a4e254f600b7b8da99">Commit - Implementation</a><br />
To support delimiter of multiple chars, I changed all of the collections from ‘IEnumerable char’ to ‘IEnumerable string’. You can notice that there is a .Single(), that’s because, based on current format and requirement, I expect only single value and delimiter. I still don’t like ref keyword in ‘ExtractDelimiters’ method, it’s an anti pattern. The only place I can think positively about ‘ref / out’ usability is ‘.TryParse()’ method. To avoid ‘ref’, ‘ExtractDelimiters’ function must return more than only single string. I can either use Tuple or create new class that would encapsulate both extracted delimiters and value. To make this simple, I decided to use ‘Tuple’. <a href="https://github.com/michal-franc/BlogStuff/commit/bd05a0d885d4e2cd1622f03200d1dd8ad6677002">Commit - Ref to Tuple</a> I also don’t like this line of code. It just too complicated and unreadable.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"> <span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">"delimeter"</span><span class="p">].</span><span class="n">Value</span><span class="p">).</span><span class="nf">Single</span><span class="p">();</span></code></pre>
</figure>

<p>Much nicer solution would be to hide this logic and extract the method.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">delim</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">ExtractRegexpGroup</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="s">"delimeter"</span><span class="p">);</span>
<span class="n">extractedInput</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">ExtractRegexpGroup</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="s">"value"</span><span class="p">);</span></code></pre>
</figure>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/f36f9744000af4243b27019e28a52662fe1794e7">Commit - extract regexp matches method</a></p>

<h3>Step - multiple delimiters</h3>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Multiple_Delimeters_Test</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">calculator</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringCalculator</span><span class="p">();</span>
    <span class="kt">var</span> <span class="k">value</span> <span class="p">=</span> <span class="s">"//[*][%]\n1*2%3"</span><span class="p">;</span>

    <span class="kt">var</span> <span class="n">actual</span> <span class="p">=</span> <span class="n">calculator</span><span class="p">.</span><span class="nf">Sum</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">expected</span> <span class="p">=</span> <span class="m">6</span><span class="p">;</span>

    <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="nf">EqualTo</span><span class="p">(</span><span class="n">expected</span><span class="p">));</span>
<span class="p">}</span></code></pre>
</figure>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/5f5b2d5c9d47dcb659ba3e9821af492fa4117fc0">Commit - Test</a> Previous solution supports only one delimiter, now We can have many delimiters separated by brackets. Current regexp in this scenario treats “[*][%]” as single delimiter. i just need to add method / regexp that will extract delimeters from this string.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">new</span> <span class="nf">Regex</span><span class="p">(</span><span class="s">"\\[(.?)\\]"</span><span class="p">))</span></code></pre>
</figure>

<p>This Regexp will take [&amp;][<em>] string and extract both ‘&amp;’ and ‘</em>’.</p>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/13a3bf60a045d94fdf499aed08cde775eeca58a4">Commit - Implementation</a> It is easy to make a mistake with regexp, I am not sure if all the extractions work fine, that’s why i want to explore more test cases with mutliple delimiters, and multi char delimiters. To do this I ll just convert previous Test to TestCases with variables.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="na">[TestCase(";;;")]</span>
<span class="na">[TestCase("x")]</span>
<span class="na">[TestCase("-----")]</span>
<span class="na">[TestCase("123456789")]</span>
<span class="na">[TestCase("              ")]</span>
<span class="na">[TestCase("\r")]</span>
<span class="na">[TestCase("()()()")]</span>
<span class="na">[TestCase("((()))")]</span>
<span class="na">[TestCase("!@#$%^^&amp;*()_+/|`~")]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">MultiCharDelimeter_Is_Supported</span><span class="p">(</span><span class="kt">string</span> <span class="n">delimiter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">calculator</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringCalculator</span><span class="p">();</span>
    <span class="kt">var</span> <span class="k">value</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"//{0}\n1{0}2{0}3{0}4"</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">actual</span> <span class="p">=</span> <span class="n">calculator</span><span class="p">.</span><span class="nf">SumFromString</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">expected</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>

    <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="nf">EqualTo</span><span class="p">(</span><span class="n">expected</span><span class="p">));</span>
<span class="p">}</span></code></pre>
</figure>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/3422fa015188e7e624a599c2b37648c4f66d7225">Commit - Test</a> Some of the delimiters looks werid, but still all the tests pass, thats a good message.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="na">[TestCase(";;;","   ")]</span>
<span class="na">[TestCase("x"," u")]</span>
<span class="na">[TestCase("-----", "---123")]</span>
<span class="na">[TestCase("123456789", "090()")]</span>
<span class="na">[TestCase("              ", "")]</span>
<span class="na">[TestCase("\r", "12x")]</span>
<span class="na">[TestCase("()()()", "^^&amp;*")]</span>
<span class="na">[TestCase("!@#$%^^&amp;*()_+/|`~", "123456")]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Multiple_Delimeters_Test</span><span class="p">(</span><span class="kt">string</span> <span class="n">delimiter1</span><span class="p">,</span> <span class="kt">string</span> <span class="n">delimeter2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">calculator</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringCalculator</span><span class="p">();</span>
    <span class="kt">var</span> <span class="k">value</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"//[{0}][{1}]\n1{0}2{1}3{0}4"</span><span class="p">,</span> <span class="n">delimiter1</span><span class="p">,</span> <span class="n">delimeter2</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">actual</span> <span class="p">=</span> <span class="n">calculator</span><span class="p">.</span><span class="nf">SumFromString</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">expected</span> <span class="p">=</span> <span class="m">6</span><span class="p">;</span>

    <span class="n">Assert</span><span class="p">.</span><span class="nf">That</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="nf">EqualTo</span><span class="p">(</span><span class="n">expected</span><span class="p">));</span>
<span class="p">}</span></code></pre>
</figure>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/38f45328dfbd8748c8cdcbf00799597d4b31e21f">Edge cases mutliple chars.</a><br />
Wow with this change ale the tests are red. There has to be some problem with regexp. The extraction of single delimiters does only work for single char delimiters. I had to do little change.</p>

<p><a href="https://github.com/michal-franc/BlogStuff/commit/a0169989f14232bf275ae7544eb9707e8ec41904">Fix for edge cases</a><br />
That would be all for now. In the last post of this serie, I will do a little cleanup with some summary of whole series. I need some advice from you dear reader: - how do you feel about using regexp, any other cool solution to do all the extractions ? - do you think that usage of Tuple is ok here, or should I create a new container class in this scenario ?</p>


      <span id="post-end"></span>
    </div>

    <div id="mc_embed_signup">
<form action="https://mfranc.us13.list-manage.com/subscribe/post?u=8a5865e28c59044d419ecbe95&amp;id=d545f31150" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">If you are interested in Cloud Native, Scalability, System Design and more meaty side of Engineering at Scale. Then subscribe to my mailing list.</label>
      <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8a5865e28c59044d419ecbe95_d545f31150" tabindex="-1" value=""></div>
        <div class="clear">
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
        </div>
    </div>
</form>
</div>



    
<hr>

<aside id="comments" class="disqus">
  <div class="container">
    <h3><i class="icon icon-comments-o"></i> Comments</h3>
    <div id="disqus_thread"></div>
    <script>
      (function() {
        var d = document,
        s = d.createElement('script');
        s.src = '//thesilenceofthelams.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</aside>



  </div>

</article>

      </div>


      <footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="http://github.com/michal-franc" target="_blank"><i class="icon icon-github"></i></a></li>
  <li><a href="http://twitter.com/francmichal" target="_blank"><i class="icon icon-twitter"></i></a></li>
  <li><a href="http://facebook.com/michalfrancblog" target="_blank"><i class="icon icon-facebook"></i></a></li>
  <li><a href="https://uk.linkedin.com/in/michalfranc1" target="_blank"><i class="icon icon-linkedin"></i></a></li>
</ul>

    <p class="txt-medium-gray">
      <small>&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


      <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.slick-modals.js"/></script>

	  <!-- <script id="ulp-remote" src="http://tools.mfranc.com/wp-content/plugins/layered-popups/js/remote.min.js?ver=5.89" data-handler="http://tools.mfranc.com/wp-admin/admin-ajax.php"></script>
	  <script>

		    (function ($) {
			"use strict";
			var objectPositionTop = $('#post-end').offset().top - window.innerHeight;

				ulp_add_event("onexit", {
					popup:		"4AXWiVSrZD71uqiP",
					mode:		"once-period",
					period:		30
				});

				ulp_add_event("onidle", {
					popup:		"85oltSbndJGZQzaW",
					mode:		"once-period",
					period:         30
				});

				ulp_add_event("onscroll", {
					popup:		"INyhHrwTzxjvcqEb",
					mode:		"once-period",
					period:         30,
					offset:		objectPositionTop / 2
				});

		    }(jQuery));

    </script> -->

		<script id="dsq-count-scr" src="//thesilenceofthelams.disqus.com/count.js" async></script>

		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.7&appId=125980610784627";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
    </main>
  </body>
</html>

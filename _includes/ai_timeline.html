<div id="transformations-timeline-container">
    <style>
        #transformations-timeline-container {
            --timeline-bg: transparent;
            --timeline-text: #e0e0e0;
            --timeline-muted: #888;
            --timeline-cyan: #00d4ff;
            --timeline-purple: #7b2cbf;
            --timeline-red: #ff6b6b;
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px 0;
            position: relative;
        }

        #transformations-timeline-container .timeline-header {
            text-align: center;
            margin-bottom: 30px;
        }

        #transformations-timeline-container .timeline-title {
            font-family: 'Space Mono', monospace;
            font-size: clamp(1.2rem, 3vw, 1.6rem);
            margin-bottom: 8px;
            background: linear-gradient(90deg, var(--timeline-cyan), var(--timeline-purple), var(--timeline-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        #transformations-timeline-container .timeline-subtitle {
            color: var(--timeline-muted);
            font-size: 0.9rem;
            font-weight: 300;
        }

        #transformations-timeline-container #timeline-svg {
            width: 100%;
            display: block;
        }

        #transformations-timeline-container .timeline-node {
            cursor: pointer;
        }

        #transformations-timeline-container .timeline-node:hover .node-circle {
            filter: brightness(1.3) drop-shadow(0 0 15px currentColor);
        }

        #transformations-timeline-container .node-circle {
            transition: all 0.3s ease;
        }

        #transformations-timeline-container .node-label {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            fill: var(--timeline-text);
            font-weight: 700;
        }

        #transformations-timeline-container .node-year {
            font-family: 'Outfit', sans-serif;
            font-size: 11px;
            fill: var(--timeline-muted);
            font-weight: 300;
        }

        #transformations-timeline-container .timeline-tooltip {
            position: absolute;
            background: rgba(20, 20, 35, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 16px;
            max-width: 280px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.25s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            z-index: 1000;
        }

        #transformations-timeline-container .timeline-tooltip.active {
            opacity: 1;
        }

        #transformations-timeline-container .timeline-tooltip h4 {
            font-family: 'Space Mono', monospace;
            font-size: 13px;
            margin: 0 0 6px 0;
            color: #fff;
        }

        #transformations-timeline-container .timeline-tooltip .tt-year {
            font-size: 11px;
            color: #666;
            margin-bottom: 10px;
        }

        #transformations-timeline-container .timeline-tooltip p {
            font-size: 12px;
            line-height: 1.5;
            color: #bbb;
            margin: 0;
        }

        #transformations-timeline-container .timeline-tooltip .tt-skepticism {
            margin-top: 8px;
            font-size: 11px;
            color: var(--timeline-red);
            font-style: italic;
        }

        #transformations-timeline-container .timeline-tooltip .tt-impact {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 10px;
            color: #888;
        }

        #transformations-timeline-container .timeline-legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        #transformations-timeline-container .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: var(--timeline-muted);
        }

        #transformations-timeline-container .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        @keyframes timelinePulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        #transformations-timeline-container .pulse-ring {
            animation: timelinePulse 2s ease-in-out infinite;
            transform-origin: center;
        }

        /* Light theme - default */
        body:not(.dark-theme) #transformations-timeline-container {
            --timeline-bg: #ffffff;
            --timeline-text: #333;
            --timeline-muted: #666;
        }

        body:not(.dark-theme) #transformations-timeline-container .timeline-tooltip {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(0, 0, 0, 0.1);
        }

        body:not(.dark-theme) #transformations-timeline-container .timeline-tooltip h4 {
            color: #222;
        }

        body:not(.dark-theme) #transformations-timeline-container .timeline-tooltip p {
            color: #555;
        }

        /* Dark theme support */
        body.dark-theme #transformations-timeline-container {
            --timeline-bg: #2B2B2B;
            --timeline-text: #A9B7C6;
            --timeline-muted: #999;
        }

        body.dark-theme #transformations-timeline-container .timeline-subtitle {
            color: #999;
        }

        body.dark-theme #transformations-timeline-container .timeline-tooltip {
            background: rgba(35, 35, 35, 0.98);
            border-color: rgba(255, 255, 255, 0.2);
        }

        body.dark-theme #transformations-timeline-container .timeline-tooltip h4 {
            color: #fff;
        }

        body.dark-theme #transformations-timeline-container .timeline-tooltip p {
            color: #bbb;
        }

        body.dark-theme #transformations-timeline-container .timeline-tooltip .tt-year {
            color: #888;
        }
    </style>

    <div class="timeline-header">
        <div class="timeline-title">// SOFTWARE ENGINEERING TRANSFORMATIONS</div>
        <div class="timeline-subtitle">Each wave abstracts complexity and shifts where value is created</div>
    </div>
    
    <svg id="timeline-svg"></svg>
    
    <div class="timeline-tooltip" id="timeline-tooltip"></div>
    
    <div class="timeline-legend">
        <div class="legend-item">
            <div class="legend-dot" style="background: #00d4ff;"></div>
            <span>Infrastructure</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #7b2cbf;"></div>
            <span>Process</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #ff6b6b;"></div>
            <span>Paradigm Shift</span>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

<script>
(function() {
    const transformations = [
        {
            id: 1,
            title: "Virtual Machines",
            shortTitle: "VMs",
            year: "~2000s",
            color: "#00d4ff",
            description: "Engineers stopped thinking about memory allocation. VMs abstracted hardware away.",
            impact: "Commoditized: Low-level memory management",
            skepticism: "How can you be a real engineer if you rely on a VM?"
        },
        {
            id: 2,
            title: "Testing Revolution",
            shortTitle: "Testing",
            year: "~2005-2010",
            color: "#7b2cbf",
            description: "Developers write tests. Testers write code. Quality became everyone's responsibility.",
            impact: "Commoditized: Manual QA processes",
            skepticism: "Developers shouldn't have to write tests!"
        },
        {
            id: 3,
            title: "DevOps & Infrastructure",
            shortTitle: "DevOps",
            year: "~2010-2015",
            color: "#7b2cbf",
            description: "Engineers expected to understand infrastructure. You build it, you run it.",
            impact: "Commoditized: Siloed operations teams",
            skepticism: "Developers can't handle production systems!"
        },
        {
            id: 4,
            title: "Cloud Computing",
            shortTitle: "Cloud",
            year: "~2010-2015",
            color: "#00d4ff",
            description: "Scalable infrastructure on demand. No more physical servers to manage.",
            impact: "Commoditized: Data center operations",
            skepticism: "Cloud will take our jobs!"
        },
        {
            id: 5,
            title: "Containers & K8s",
            shortTitle: "Containers",
            year: "~2015-2020",
            color: "#00d4ff",
            description: "Docker and Kubernetes simplified deployment and system architecture.",
            impact: "Commoditized: Environment configuration",
            skepticism: "Too complex! VMs were fine!"
        },
        {
            id: 6,
            title: "AI & Code Generation",
            shortTitle: "AI",
            year: "2023+",
            color: "#ff6b6b",
            description: "Coding itself becomes commoditized. Value shifts to architecture and business impact.",
            impact: "Commoditizing: Code writing itself",
            skepticism: "AI will replace engineers!"
        }
    ];

    const container = document.getElementById('transformations-timeline-container');
    const svgElement = document.getElementById('timeline-svg');
    const tooltip = document.getElementById('timeline-tooltip');

    function render() {
        const containerWidth = container.offsetWidth;
        const margin = { top: 50, right: 30, bottom: 50, left: 30 };
        const width = containerWidth - margin.left - margin.right;
        const height = 200;

        svgElement.innerHTML = '';
        svgElement.setAttribute('width', containerWidth);
        svgElement.setAttribute('height', height + margin.top + margin.bottom);
        svgElement.setAttribute('viewBox', `0 0 ${containerWidth} ${height + margin.top + margin.bottom}`);

        const svg = d3.select(svgElement)
            .append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);

        const defs = svg.append('defs');

        // Glow filter
        const filter = defs.append('filter')
            .attr('id', 'timeline-glow')
            .attr('x', '-50%')
            .attr('y', '-50%')
            .attr('width', '200%')
            .attr('height', '200%');

        filter.append('feGaussianBlur')
            .attr('stdDeviation', '2.5')
            .attr('result', 'coloredBlur');

        const feMerge = filter.append('feMerge');
        feMerge.append('feMergeNode').attr('in', 'coloredBlur');
        feMerge.append('feMergeNode').attr('in', 'SourceGraphic');

        const xScale = d3.scaleLinear()
            .domain([0, transformations.length - 1])
            .range([40, width - 40]);

        const yBase = height / 2;

        // Draw connecting segments
        for (let i = 0; i < transformations.length - 1; i++) {
            const segmentGradient = defs.append('linearGradient')
                .attr('id', `embed-segment-${i}`)
                .attr('x1', '0%')
                .attr('x2', '100%');

            segmentGradient.append('stop')
                .attr('offset', '0%')
                .attr('stop-color', transformations[i].color);

            segmentGradient.append('stop')
                .attr('offset', '100%')
                .attr('stop-color', transformations[i + 1].color);

            svg.append('line')
                .attr('x1', xScale(i))
                .attr('y1', yBase)
                .attr('x2', xScale(i + 1))
                .attr('y2', yBase)
                .attr('stroke', `url(#embed-segment-${i})`)
                .attr('stroke-width', 3)
                .attr('opacity', 0.7)
                .attr('stroke-linecap', 'round');
        }

        // Arrow
        svg.append('polygon')
            .attr('points', `${width},${yBase} ${width - 8},${yBase - 6} ${width - 8},${yBase + 6}`)
            .attr('fill', '#ff6b6b')
            .attr('opacity', 0.5);

        // Nodes
        const nodes = svg.selectAll('.timeline-node')
            .data(transformations)
            .enter()
            .append('g')
            .attr('class', 'timeline-node')
            .attr('transform', (d, i) => `translate(${xScale(i)}, ${yBase})`);

        // Pulse ring for AI node
        nodes.filter(d => d.id === 6)
            .append('circle')
            .attr('class', 'pulse-ring')
            .attr('r', 28)
            .attr('fill', 'none')
            .attr('stroke', d => d.color)
            .attr('stroke-width', 1.5)
            .attr('opacity', 0.3);

        // Outer glow
        nodes.append('circle')
            .attr('r', 22)
            .attr('fill', d => d.color)
            .attr('opacity', 0.12);

        // Main circle
        nodes.append('circle')
            .attr('class', 'node-circle')
            .attr('r', 16)
            .attr('fill', d => d.color)
            .attr('opacity', 0.85)
            .style('filter', 'url(#timeline-glow)');

        // Inner circle - adapt to theme
        const isDarkTheme = document.body.classList.contains('dark-theme');
        const innerCircleColor = isDarkTheme ? '#f0f0f0' : '#0a0a0f';

        nodes.append('circle')
            .attr('r', 6)
            .attr('fill', innerCircleColor)
            .attr('opacity', 0.7);

        // Year
        nodes.append('text')
            .attr('class', 'node-year')
            .attr('y', -35)
            .attr('text-anchor', 'middle')
            .text(d => d.year);

        // Label
        nodes.append('text')
            .attr('class', 'node-label')
            .attr('y', 38)
            .attr('text-anchor', 'middle')
            .text(d => d.shortTitle);

        // Hover interactions
        nodes.on('mouseenter', function(event, d) {
            tooltip.innerHTML = `
                <h4 style="color: ${d.color}">${d.title}</h4>
                <div class="tt-year">${d.year}</div>
                <p>${d.description}</p>
                <p class="tt-skepticism">"${d.skepticism}"</p>
                <div class="tt-impact">â†’ ${d.impact}</div>
            `;

            const rect = container.getBoundingClientRect();
            const nodeRect = this.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            
            let left = nodeRect.left - rect.left + nodeRect.width / 2 - 140;
            left = Math.max(10, Math.min(left, rect.width - 290));
            
            tooltip.style.left = `${left}px`;
            tooltip.style.top = `${nodeRect.top - rect.top - tooltipRect.height - 15}px`;
            tooltip.classList.add('active');
        })
        .on('mouseleave', function() {
            tooltip.classList.remove('active');
        });
    }

    render();
    window.addEventListener('resize', render);

    // Re-render when theme changes
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
                render();
            }
        });
    });

    observer.observe(document.body, {
        attributes: true,
        attributeFilter: ['class']
    });
})();
</script>

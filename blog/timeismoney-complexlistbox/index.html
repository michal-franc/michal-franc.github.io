<!DOCTYPE html>
<html>
    <head>

    
    <meta name="robots" content="all">
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Michal Franc">
    <meta name="keywords" content="michal franc,leader,programmer,coach,speaker">
	<title>Custom ListBox - using Attributes to create dynamic Controls | Michal Franc</title>
	<meta name="description" content="This is the Control I created for my mini project TimeIsMoney. It is a simple ListBox with a “complex item” creation logic . NewItemBox which is used to crea...">

    <link href="https://fonts.googleapis.com/css?family=Inconsolata:700|Raleway" rel="stylesheet">
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="author" href="https://plus.google.com/104238159697387202725?rel=author">

	<link rel="canonical" href="http://www.mfranc.com/blog/timeismoney-complexlistbox/">

    <link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" type="text/css" href="/css/sm.css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Michal Franc | Feed" href="http://feeds.feedburner.com/PassionateProgram">

    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="Custom ListBox - using Attributes to create dynamic Controls | Michal Franc">
    <meta property="og:description" content="This is the Control I created for my mini project TimeIsMoney. It is a simple ListBox with a “complex item” creation logic . NewItemBox which is used to crea...">
	<meta property="og:url" content="http://www.mfranc.com/blog/timeismoney-complexlistbox/">
    <meta property="og:site_name" content="Michal Franc Blog">
    <meta property="og:type" content="website">
	<meta property="og:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

	<meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Custom ListBox - using Attributes to create dynamic Controls | Michal Franc">
    <meta name="twitter:site" content="@francmichal">
    <meta name="twitter:creator" content="@francmichal">
    <meta name="twitter:description" content="This is the Control I created for my mini project TimeIsMoney. It is a simple ListBox with a “complex item” creation logic . NewItemBox which is used to crea...">
	<meta name="twitter:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-15894596-3', 'auto');
  ga('send', 'pageview');
</script>

    <script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100563098); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100563098ns.gif" /></p></noscript>

    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

    <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1817837425153843'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1817837425153843&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->


  </head>


  <body>
    <main>
      <header class="site-header">
  <div class="container">
	  <h1><a href="/">Michal<span>Franc</span></a></h1>

    <button type="button" class="sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="navbar sliding-panel-content">
      <ul>
        
          <li><a href="/blog" title="Posts">Posts</a></li>
        
          <li><a href="/notes" title="Notes">Notes</a></li>
        
          <li><a href="/articles" title="Articles">Articles</a></li>
        
          <li><a href="/about" title="About">About</a></li>
        
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="sliding-panel-fade-screen"></div>


      <div class="container">
        <article role="article" class="post">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">Custom ListBox - using Attributes to create dynamic Controls</h1>
      <p class="post-meta">Jul 31, 2010 • Michal Franc - 
		<small>
			<i class="icon icon-comments"></i><span class="disqus-comment-count" data-disqus-url="http://mfranc.com/blog/timeismoney-complexlistbox/"></span>
		</small>
		<small>
			
		</small>
	  </p>
    </header>

	<center>
		
	</center>

    <div class="post-content">
      
      <p style="text-align: justify; padding-left: 30px;">This is the Control I created for my mini project <strong>TimeIsMoney</strong>. It is a simple ListBox with a <strong>“complex item</strong>” creation logic . <strong>NewItemBox </strong>which is used to create new Item is modifying itself based on the Object type. The Control is used to create “TaskBins” which are containers of Tasks. The main <strong>TaskBin </strong>is our “UnsortedBin”. Here we have items waiting to be sorted. Then we can add multiple Bins which are used to store the sorted Items</p>
<p style="text-align: justify;"></p>

<h2><span style="color: #000000;"><strong><span style="color: #ff6600;">What is it ?</span></strong></span></h2>
<p><span style="color: #000000;"><strong>
</strong></span></p>
<p style="padding-left: 30px;">The control contains 1 ListBox and 2 Buttons.</p>
<p style="padding-left: 30px;"><a href="http://lammichalfranc.files.wordpress.com/2010/07/timeismoney1.png"><img class="aligncenter size-full wp-image-487" title="TimeIsMoney1" src="http://lammichalfranc.files.wordpress.com/2010/07/timeismoney1.png" alt="" width="294" height="266" /></a></p>
<p style="padding-left: 30px;">By clicking the add button a new <strong>NewItemBox</strong> Appears with dynamically created controls.</p>
<p style="padding-left: 30px;"><a href="http://lammichalfranc.files.wordpress.com/2010/07/timeismoney2.png"><img class="aligncenter size-full wp-image-488" title="TimeIsMoney2" src="http://lammichalfranc.files.wordpress.com/2010/07/timeismoney2.png" alt="" width="339" height="285" /></a></p>
<p style="padding-left: 30px;"><strong>NewItemBox</strong> It analyzes the properties of the class and creates new controls. By creating a new property in <strong>TaskBin</strong> the Control will create a new control. By this behavior I don’t have to worry about changes.</p>

<h2><span style="color: #ff6600;">How Does it Work ?</span></h2>
<p style="padding-left: 30px;">Everything is based on properties decorated by the attributes. Let’s take a look at <strong>TaskBin</strong> class</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="na">[Serializable]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">TaskBin</span> <span class="p">:</span> <span class="n">IEditable</span><span class="p">;</span><span class="n">TaskBin</span><span class="p">;</span>
<span class="p">{</span>
     <span class="p">[</span><span class="n">EditableDialogBox</span><span class="p">]</span>
     <span class="k">public</span> <span class="kt">string</span> <span class="n">Address</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
     <span class="p">[</span><span class="n">EditableTextBox</span><span class="p">]</span>
     <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

     <span class="k">public</span> <span class="kt">string</span> <span class="n">DisplayMember</span>
     <span class="p">{</span>
          <span class="k">get</span>
          <span class="p">{</span>
               <span class="k">return</span> <span class="s">"Name"</span><span class="p">;</span>
          <span class="p">}</span>
     <span class="p">}</span>

<span class="cp">#region IEditable&lt;TaskBin&gt; Members
</span>
     <span class="k">public</span> <span class="n">TaskBin</span> <span class="nf">CreateFromString</span><span class="p">(</span><span class="kt">string</span> <span class="n">stringObject</span><span class="p">)</span>
     <span class="p">{</span>
          <span class="kt">string</span><span class="p">[]</span> <span class="n">datas</span> <span class="p">=</span> <span class="n">stringObject</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">';'</span><span class="p">);</span>
          <span class="k">return</span> <span class="k">new</span> <span class="nf">TaskBin</span><span class="p">()</span> <span class="p">{</span> <span class="n">Address</span> <span class="p">=</span> <span class="n">datas</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">Name</span> <span class="p">=</span> <span class="n">datas</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">};</span>
     <span class="p">}</span>

<span class="cp">#endregion
</span><span class="p">}</span></code></pre>
</figure>

<p> </p>

<p>As you can see Address and Name property are decorated by <strong>EditableDialogBox </strong>and <strong>EditableTextBox </strong>Attribute [This is a simple class inheriting from the Attribute class]</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">EditableTextBox</span> <span class="p">:</span> <span class="n">Attribute</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">EditableDialogBox</span> <span class="p">:</span> <span class="n">Attribute</span>
<span class="p">{</span>
<span class="p">}</span></code></pre>
</figure>

<p style="padding-left: 30px; text-align: justify;">Those are empty classes. You can add some logic and behaviors to them.I m just using them to mark the properties which will be represented as a TextBox in the NewItemBox. Every property with an [Editable…..] attribute will have a textbox and user will be able to edit it .The displayMember proeprty doesn’t have an Attribute so it wont available for the user. It is used for DataBinding to set the displayed property name on the ListBox].</p>
<p style="padding-left: 30px;">To check if the property has a specific attribute you need to use the Reflection mechanism.</p>
<p> </p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">foreach</span> <span class="p">(</span><span class="n">PropertyInfo</span> <span class="n">prop</span> <span class="k">in</span> <span class="n">type</span><span class="p">.</span><span class="nf">GetProperties</span><span class="p">())</span>
<span class="p">{</span>
     <span class="c1">//Checking if property is decorated with EditableProperty Attribute
</span>     <span class="k">if</span> <span class="p">(</span><span class="n">prop</span><span class="p">.</span><span class="nf">IsDefined</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">EditableTextBox</span><span class="p">),</span> <span class="k">false</span><span class="p">))</span>
     <span class="p">{</span>
          <span class="n">newBox</span><span class="p">.</span><span class="nf">CreateTextBox</span><span class="p">(</span><span class="n">prop</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">prop</span><span class="p">.</span><span class="nf">IsDefined</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">EditableDialogBox</span><span class="p">),</span><span class="k">false</span><span class="p">))</span>
     <span class="p">{</span>
          <span class="n">newBox</span><span class="p">.</span><span class="nf">CreateFileDialogButton</span><span class="p">(</span><span class="n">prop</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span><span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">}</span></code></pre>
</figure>

<p style="padding-left: 30px; text-align: justify;">Using reflection we are iterating through the properties of the Object and checking if they are decorated by an Attribute. To perform this check i m using the IsDefined method. There are only two attributes right now. Each of them generates different logic in the NewItemBox.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">void</span> <span class="nf">CreateTextBox</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Label</span><span class="p">()</span> <span class="p">{</span> <span class="n">Text</span> <span class="p">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">Location</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TextBox</span><span class="p">()</span> <span class="p">{</span> <span class="n">Location</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">y</span> <span class="p">+</span> <span class="m">20</span><span class="p">)</span> <span class="p">});</span>
    <span class="n">y</span> <span class="p">+=</span> <span class="m">40</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">CreateFileDialogButton</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">string</span> <span class="n">filter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Label</span><span class="p">()</span> <span class="p">{</span> <span class="n">Text</span> <span class="p">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">Location</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">});</span>
    <span class="n">TextBox</span> <span class="n">dialogText</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TextBox</span><span class="p">();</span>
    <span class="n">dialogText</span><span class="p">.</span><span class="n">Click</span> <span class="p">+=</span> <span class="k">new</span> <span class="nf">EventHandler</span><span class="p">(</span><span class="n">dialog_Click</span><span class="p">);</span>
    <span class="n">dialogText</span><span class="p">.</span><span class="n">Location</span> <span class="p">=</span> <span class="n">Location</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">y</span> <span class="p">+</span> <span class="m">20</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">dialogText</span><span class="p">);</span>
    <span class="n">y</span> <span class="p">+=</span> <span class="m">40</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</figure>

<p style="padding-left: 30px; text-align: justify;">Property with EditableTextBox attribute generates a simple Label with its name and TextBox. EditableDialogBox generates label, textbox and creates an Event Handler handled by the click Event. „dialog_Click” event summons the FileDialogBox which is used to set The TaskBin physical path.</p>
<p style="padding-left: 30px; text-align: justify;">We have a code to create a dynamic edit box but how to pass this data further to our main lists. To do this I created I mechanism which converts all the data from the controls to the string.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="kt">string</span> <span class="nf">GenerateStringObject</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">returnString</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="n">Control</span> <span class="n">c</span> <span class="k">in</span> <span class="n">Controls</span><span class="p">)</span>
    <span class="p">{</span>
          <span class="n">returnString</span> <span class="p">+=</span> <span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">quot</span><span class="p">;{</span><span class="m">0</span><span class="p">};&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">quot</span><span class="p">;,</span> <span class="n">c</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="k">return</span> <span class="n">returnString</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</figure>

<p>Class which is on the list, implements an IEditable Interface.</p>

<p> </p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="cp">#region IEditable&lt;TaskBin&gt; Members
</span>
<span class="k">public</span> <span class="n">TaskBin</span> <span class="nf">CreateFromString</span><span class="p">(</span><span class="kt">string</span> <span class="n">stringObject</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">string</span><span class="p">[]</span> <span class="n">datas</span> <span class="p">=</span> <span class="n">stringObject</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="sc">';'</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">TaskBin</span><span class="p">()</span> <span class="p">{</span> <span class="n">Address</span> <span class="p">=</span> <span class="n">datas</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">Name</span> <span class="p">=</span> <span class="n">datas</span><span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="p">};</span>
<span class="p">}</span>

<span class="err">#</span><span class="n">endregion</span></code></pre>
</figure>

<h2><span style="color: #ff6600;">How can I use it ?</span></h2>
<p style="padding-left: 30px;"><span style="color: #ff6600;">
</span></p>
<p style="padding-left: 30px;">In MainForm initialize the control with DataSource and Object type. Control saves changes directly to the specified DataSource</p>

      <span id="post-end"></span>
    </div>

    <div id="mc_embed_signup">
<form action="https://mfranc.us13.list-manage.com/subscribe/post?u=8a5865e28c59044d419ecbe95&amp;id=d545f31150" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">If you are interested in Cloud Native, Scalability, System Design and more meaty side of Engineering at Scale. Then subscribe to my mailing list.</label>
      <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8a5865e28c59044d419ecbe95_d545f31150" tabindex="-1" value=""></div>
        <div class="clear">
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
        </div>
    </div>
</form>
</div>



    
<hr>

<aside id="comments" class="disqus">
  <div class="container">
    <h3><i class="icon icon-comments-o"></i> Comments</h3>
    <div id="disqus_thread"></div>
    <script>
      (function() {
        var d = document,
        s = d.createElement('script');
        s.src = '//thesilenceofthelams.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</aside>



  </div>

</article>

      </div>


      <footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="http://github.com/michal-franc" target="_blank"><i class="icon icon-github"></i></a></li>
  <li><a href="http://twitter.com/francmichal" target="_blank"><i class="icon icon-twitter"></i></a></li>
  <li><a href="http://facebook.com/michalfrancblog" target="_blank"><i class="icon icon-facebook"></i></a></li>
  <li><a href="https://uk.linkedin.com/in/michalfranc1" target="_blank"><i class="icon icon-linkedin"></i></a></li>
</ul>

    <p class="txt-medium-gray">
      <small>&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


      <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.slick-modals.js"/></script>

	  <!-- <script id="ulp-remote" src="http://tools.mfranc.com/wp-content/plugins/layered-popups/js/remote.min.js?ver=5.89" data-handler="http://tools.mfranc.com/wp-admin/admin-ajax.php"></script>
	  <script>

		    (function ($) {
			"use strict";
			var objectPositionTop = $('#post-end').offset().top - window.innerHeight;

				ulp_add_event("onexit", {
					popup:		"4AXWiVSrZD71uqiP",
					mode:		"once-period",
					period:		30
				});

				ulp_add_event("onidle", {
					popup:		"85oltSbndJGZQzaW",
					mode:		"once-period",
					period:         30
				});

				ulp_add_event("onscroll", {
					popup:		"INyhHrwTzxjvcqEb",
					mode:		"once-period",
					period:         30,
					offset:		objectPositionTop / 2
				});

		    }(jQuery));

    </script> -->

		<script id="dsq-count-scr" src="//thesilenceofthelams.disqus.com/count.js" async></script>

		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.7&appId=125980610784627";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
    </main>
  </body>
</html>

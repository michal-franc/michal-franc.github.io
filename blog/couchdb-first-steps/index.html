<!DOCTYPE html>
<html>
    <head>

    
    <meta name="robots" content="all">
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Michal Franc">
    <meta name="keywords" content="michal franc,leader,programmer,coach,speaker">
	<title>CouchDB - First Steps | Michal Franc</title>
	<meta name="description" content="Long long time ago in one of the posts … I briefly described CouchDB installation process on the local machine.">

    <link href="https://fonts.googleapis.com/css?family=Inconsolata:700|Raleway" rel="stylesheet">
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="author" href="https://plus.google.com/104238159697387202725?rel=author">

	<link rel="canonical" href="http://www.mfranc.com/blog/couchdb-first-steps/">

    <link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" type="text/css" href="/css/sm.css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Michal Franc | Feed" href="http://feeds.feedburner.com/PassionateProgram">

    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="CouchDB - First Steps | Michal Franc">
    <meta property="og:description" content="Long long time ago in one of the posts … I briefly described CouchDB installation process on the local machine.">
	<meta property="og:url" content="http://www.mfranc.com/blog/couchdb-first-steps/">
    <meta property="og:site_name" content="Michal Franc Blog">
    <meta property="og:type" content="website">
	<meta property="og:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

	<meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CouchDB - First Steps | Michal Franc">
    <meta name="twitter:site" content="@francmichal">
    <meta name="twitter:creator" content="@francmichal">
    <meta name="twitter:description" content="Long long time ago in one of the posts … I briefly described CouchDB installation process on the local machine.">
	<meta name="twitter:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-15894596-3', 'auto');
  ga('send', 'pageview');
</script>

    <script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100563098); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100563098ns.gif" /></p></noscript>

    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

    <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1817837425153843'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1817837425153843&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->


  </head>


  <body>
    <main>
      <header class="site-header">
  <div class="container">
	  <h1><a href="/">Michal<span>Franc</span></a></h1>

    <button type="button" class="sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="navbar sliding-panel-content">
      <ul>
        
          <li><a href="/blog" title="Posts">Posts</a></li>
        
          <li><a href="/notes" title="Notes">Notes</a></li>
        
          <li><a href="/articles" title="Articles">Articles</a></li>
        
          <li><a href="/about" title="About">About</a></li>
        
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="sliding-panel-fade-screen"></div>


      <div class="container">
        <article role="article" class="post">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">CouchDB - First Steps</h1>
      <p class="post-meta">Apr 30, 2013 • Michal Franc - 
		<small>
			<i class="icon icon-comments"></i><span class="disqus-comment-count" data-disqus-url="http://mfranc.com/blog/couchdb-first-steps/"></span>
		</small>
		<small>
			
			<a class="tag-badge" href="/blog/tags/#nosql">nosql</a>
			
		</small>
	  </p>
    </header>

	<center>
		
	</center>

    <div class="post-content">
      
      <p>Long long time ago in one of the posts … I briefly described CouchDB installation process on the local machine.</p>

<h3>IrisCouch</h3>

<p>If you don’t want to configure local database you can use <a href="http://www.iriscouch.com/">IrisCouch hosting</a>.
You can get free database for basic tests. I am using this database hosting for one of the projects hosted in heroku. It is free for really basic usage.</p>

<p>Now we can play with our new toy. Let’s start with some general concepts.</p>

<h3>Where are my tables ?</h3>

<p>Quick answer there are no tables. Data is stored in a form of documents, which are JSON objects. Each document have properties. Properties are like columns. You can story values, array of objects, custom objects in them.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="p">{</span>
   <span class="s">"_id"</span><span class="p">:</span> <span class="s">"40e4bddb4071125d6fb2e559c107d91f"</span><span class="p">,</span>
   <span class="s">"_rev"</span><span class="p">:</span> <span class="s">"1-ff557593af8688073e77405d96231a87"</span><span class="p">,</span>
   <span class="s">"type"</span><span class="p">:</span> <span class="s">"feed"</span><span class="p">,</span>
   <span class="s">"url"</span><span class="p">:</span> <span class="s">"http://feeds.feedburner.com/maciejaniserowicz"</span><span class="p">,</span>
   <span class="s">"isActive"</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
   <span class="s">"isApproved"</span><span class="p">:</span> <span class="k">true</span>
<span class="p">}</span></code></pre>
</figure>

<p>Here is a simple example. This document has properties : isActive, isApproved, type, url.</p>

<p><b>_id</b> is a special value that has to be unique for each document. You can assign it by yourself, but it is also generated automaticly when you add document. Automatic value is a representation of UUID.</p>

<p><b>_rev</b> is a special identification number which is used for the document versioning. Each time you save changes to the document _rev value is regenerated.</p>

<h2>How to query this freaking thing ?</h2>

<p>With this little introduction it is time create first query. I was using mostly relational databases that used SQL language to write queries. In CouchDB it is not simple like that. There is no SQL language and you don’t write queries. Instead you create map/reduce functions that are stored in CouchDB in form of custom views.</p>

<p>Map function is used to filter out the data. We can think of it as QUERY with WHERE clause and SELECT statement.</p>

<p>Reduce function is used to transform data to a new object. You can perform operations like SUM or COUNT here. I will write about this particular function in some later posts. Let’s focus now on querying the data.</p>

<h3>Map function</h3>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="nf">function</span> <span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
              <span class="kt">var</span> <span class="n">id</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">_id</span><span class="p">;</span>
              <span class="k">if</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">type</span> <span class="p">===</span> <span class="err">'</span><span class="n">feed</span><span class="err">'</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="p">!</span><span class="n">doc</span><span class="p">.</span><span class="n">isApproved</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">var</span> <span class="n">url</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">url</span><span class="p">;</span>
                <span class="nf">emit</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">url</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span></code></pre>
</figure>

<p>In CouchDB map function  === javascript function. It takes document as a parameter and returns nothing. Instead of return you have to use emit function. Map function iterates through all the documents and tries to match the document based on the if clause. If the document is matched we call the emit function.</p>

<p>emit() function takes two arguments ( key, value). This function can be called mutliple times in one map function and is used to create the view result with rows each containing key and value. View result then is converted to JSON object that contains rows and metadata.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="p">{</span>
  <span class="s">"total_rows"</span><span class="p">:</span> <span class="m">0</span><span class="p">,</span>
  <span class="s">"offset"</span><span class="p">:</span> <span class="m">0</span><span class="p">,</span>
  <span class="s">"rows"</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">]</span>
<span class="p">}</span></code></pre>
</figure>

<h2>Accesing data from the browser</h2>

<p>The nice thing about CouchDb is that we can access data by using the HTTP protocol. Simple GET message is all we need to  access data.</p>

<p>For example: GET to - http://localhost:5984/database.name/id</p>

<p>Returns the document with the id. You can make GET query to views, documents, database. It is quite usefull when you want to access data from javascript without the hassle of installing all the different frameworks.</p>

<p>In one of the apps on  node.js, I am using nano module to access the database. This module is just a wrapper to the HTTP protocol.</p>

<h3>Summary</h3>

<p>That’s it for now. CouchDB is a nice database engine slightly different than Redis engine that I used recently. My experience with NoSql is still little low. But it is a fun thing to learn. I believe in a multiple databases used in the project with specialised database engines used for different things. You can read about this on <a href="http://martinfowler.com/bliki/PolyglotPersistence.html">Martin Fowler blog.</a>.</p>

<p>Stay tuned for more CoudhDB adventures.</p>

      <span id="post-end"></span>
    </div>

    <div id="mc_embed_signup">
<form action="https://mfranc.us13.list-manage.com/subscribe/post?u=8a5865e28c59044d419ecbe95&amp;id=d545f31150" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">If you are interested in Cloud Native, Scalability, System Design and more meaty side of Engineering at Scale. Then subscribe to my mailing list.</label>
      <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8a5865e28c59044d419ecbe95_d545f31150" tabindex="-1" value=""></div>
        <div class="clear">
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
        </div>
    </div>
</form>
</div>



    
<hr>

<aside id="comments" class="disqus">
  <div class="container">
    <h3><i class="icon icon-comments-o"></i> Comments</h3>
    <div id="disqus_thread"></div>
    <script>
      (function() {
        var d = document,
        s = d.createElement('script');
        s.src = '//thesilenceofthelams.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</aside>



  </div>

</article>

      </div>


      <footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="http://github.com/michal-franc" target="_blank"><i class="icon icon-github"></i></a></li>
  <li><a href="http://twitter.com/francmichal" target="_blank"><i class="icon icon-twitter"></i></a></li>
  <li><a href="http://facebook.com/michalfrancblog" target="_blank"><i class="icon icon-facebook"></i></a></li>
  <li><a href="https://uk.linkedin.com/in/michalfranc1" target="_blank"><i class="icon icon-linkedin"></i></a></li>
</ul>

    <p class="txt-medium-gray">
      <small>&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


      <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.slick-modals.js"/></script>

	  <!-- <script id="ulp-remote" src="http://tools.mfranc.com/wp-content/plugins/layered-popups/js/remote.min.js?ver=5.89" data-handler="http://tools.mfranc.com/wp-admin/admin-ajax.php"></script>
	  <script>

		    (function ($) {
			"use strict";
			var objectPositionTop = $('#post-end').offset().top - window.innerHeight;

				ulp_add_event("onexit", {
					popup:		"4AXWiVSrZD71uqiP",
					mode:		"once-period",
					period:		30
				});

				ulp_add_event("onidle", {
					popup:		"85oltSbndJGZQzaW",
					mode:		"once-period",
					period:         30
				});

				ulp_add_event("onscroll", {
					popup:		"INyhHrwTzxjvcqEb",
					mode:		"once-period",
					period:         30,
					offset:		objectPositionTop / 2
				});

		    }(jQuery));

    </script> -->

		<script id="dsq-count-scr" src="//thesilenceofthelams.disqus.com/count.js" async></script>

		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.7&appId=125980610784627";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
    </main>
  </body>
</html>

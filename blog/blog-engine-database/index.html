<!DOCTYPE html>
<html>
    <head>

    
    <meta name="robots" content="all">
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Michal Franc">
    <meta name="keywords" content="michal franc,leader,programmer,coach,speaker">
	<title>BlogEngine .Net + Database | Michal Franc</title>
	<meta name="description" content="">

    <link href="https://fonts.googleapis.com/css?family=Inconsolata:700|Raleway" rel="stylesheet">
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="author" href="https://plus.google.com/104238159697387202725?rel=author">

	<link rel="canonical" href="http://www.mfranc.com/blog/blog-engine-database/">

    <link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" type="text/css" href="/css/sm.css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Michal Franc | Feed" href="http://feeds.feedburner.com/PassionateProgram">

    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="BlogEngine .Net + Database | Michal Franc">
    <meta property="og:description" content="">
	<meta property="og:url" content="http://www.mfranc.com/blog/blog-engine-database/">
    <meta property="og:site_name" content="Michal Franc Blog">
    <meta property="og:type" content="website">
	<meta property="og:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

	<meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="BlogEngine .Net + Database | Michal Franc">
    <meta name="twitter:site" content="@francmichal">
    <meta name="twitter:creator" content="@francmichal">
    <meta name="twitter:description" content="">
	<meta name="twitter:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-15894596-3', 'auto');
  ga('send', 'pageview');
</script>

    <script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100563098); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100563098ns.gif" /></p></noscript>

    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

    <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1817837425153843'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1817837425153843&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->


  </head>


  <body>
    <main>
      <header class="site-header">
  <div class="container">
	  <h1><a href="/">Michal<span>Franc</span></a></h1>

    <button type="button" class="sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="navbar sliding-panel-content">
      <ul>
        
          <li><a href="/blog" title="Posts">Posts</a></li>
        
          <li><a href="/notes" title="Notes">Notes</a></li>
        
          <li><a href="/articles" title="Articles">Articles</a></li>
        
          <li><a href="/about" title="About">About</a></li>
        
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="sliding-panel-fade-screen"></div>


      <div class="container">
        <article role="article" class="post">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">BlogEngine .Net + Database</h1>
      <p class="post-meta">Mar 6, 2010 • Michal Franc - 
		<small>
			<i class="icon icon-comments"></i><span class="disqus-comment-count" data-disqus-url="http://mfranc.com/blog/blog-engine-database/"></span>
		</small>
		<small>
			
		</small>
	  </p>
    </header>

	<center>
		
	</center>

    <div class="post-content">
      
      <div>

  <p>In the future i m planning to redeploy my blog on BlogEngine.Net and because in my <a href="http://www.grupaeka.pl">.Net Group</a> we are making a site also on this engine i m going to explain / write about this great platform. I think that this post could lead to a thematic series about mechanism in BlogEngine .Net</p>

  <p>The engine has a nice architecture and you can learn a lot from it. There are lot of design patterns in practical use.</p>
  <h2>Let’sStart with BlogEngine DataSource.</h2>
  <p>Databases are one of the typical choices when we want to store all kinds of data. Comments , Posts , UserData etc.  nowadays almost everything is stored in Databases. Smae goes for BlogEngine .Net. There is also a different DataStore available , XML stored data , this aproach uses XML files. :et’sleave this interesting approach for a later post.</p>

  <p>There are a lot of DataBase Engines available. We can use MSSql , MySql , OracleDb etc. They are based on official <a href="http://en.wikipedia.org/wiki/SQL">SQL specification</a>. Of course when there is a big competition on the market there are different ideas and implementations. Every Engine has its own unique featuers and solutions almost their own original language.</p>
  <blockquote>
    <address>
      <p>Detailed Comparision :  <a href="http://troels.arvin.dk/db/rdbms/">Comparison of different SQL implementations</a> <a href="http://www.postgresonline.com/journal/index.php?/archives/51-Cross-Compare-of-SQL-Server,-MySQL,-and-PostgreSQL.html">CROSS COMPARE OF SQL SERVER, MYSQL, AND POSTGRESQL</a>&lt;/address&gt;&lt;/blockquote&gt;</p>
      <address>
        <p> &lt;/address&gt;&lt;address&gt; &lt;/address&gt;&lt;address&gt;<a href="http://lammichalfranc.files.wordpress.com/2010/03/strona-ze-zrodlem-danych.jpg"><img class="aligncenter" title="Strona ze zrodlem danych" src="http://lammichalfranc.files.wordpress.com/2010/03/strona-ze-zrodlem-danych.jpg" alt="" width="450" height="206" /></a>&lt;/address&gt;Fortunately core of the SQL standard is solid. It is a basis upon which concrete technologies are built. We can create universal “code” based on the standard which will run on every technology. This is very important , we can create independet code.  Remember ……</p>
        <blockquote>
          <p>“<em>Program to an ‘interface</em>’, <em>not an ‘implementation</em>’.” (Gang of Four 1995:18)&lt;/blockquote&gt;
If you are programming to concrete implementation you are asking yourself for problems in the near future.</p>

          <p>BlogEngine’s database code is based on the Abstract Factory pattern. The Factory creates specific implementation by analyzing parameters in Connection String. The implementation contains concrete methods to specific DataBase implementation. Everything is nicely “wrapped” in Provider Factory. The Provider class defines the interface , common methods for every provider. This creates an abstraction layer between our program logic and Data Source.</p>

          <p><a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Abstract Factory</a> is a design pattern , which conceals the “creation” logic of the object. Factory returns wrapped object based on the parameters. In our case we are getting generic object used to comunicate with every Database. We doesn’t have to worry about its implementation. It is hidden and should be. We should be interested only on the interface which is the same for every class.</p>

          <p>The Provider Factory is creating DBProviderFactory Object which is used to create  Connection and Command. Those are abstract objects. Their role is to delegate our task to objects which are inheriting from them.</p>

          <p>The Concrete implementation of MSSQL logic , in the SQLCommand , inherits from DBCommand. By using the Down Cast it changes our “general” DBCommand class to more concrete and specific Object SQLCommand. By changing the Provider we are just changing the inherited class which is hidden behind the DBCommand</p>

          <figure class="highlight">
            <pre><code class="language-csharp" data-lang="csharp"><span class="kt">string</span> <span class="n">connString</span><span class="p">=</span><span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">ConnectionStrings</span><span class="p">[</span><span class="n">connStringName</span><span class="p">].</span><span class="n">ConnectionString</span><span class="p">;</span> 

<span class="kt">string</span> <span class="n">providerName</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">ConnectionStrings</span><span class="p">[</span><span class="n">connStringName</span><span class="p">].</span><span class="n">ProviderName</span><span class="p">;</span> 

<span class="n">DbProviderFactory</span> <span class="n">provider</span> <span class="p">=</span> <span class="n">DbProviderFactories</span><span class="p">.</span><span class="nf">GetFactory</span><span class="p">(</span><span class="n">providerName</span><span class="p">);</span> 
<span class="k">using</span> <span class="p">(</span><span class="n">DbConnection</span> <span class="n">conn</span> <span class="p">=</span> <span class="n">provider</span><span class="p">.</span><span class="nf">CreateConnection</span><span class="p">())</span>
   <span class="p">{</span>
     <span class="n">conn</span><span class="p">.</span><span class="n">ConnectionString</span> <span class="p">=</span> <span class="n">connString</span><span class="p">;</span> 
         <span class="k">using</span> <span class="p">(</span><span class="n">DbCommand</span> <span class="n">cmd</span> <span class="p">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">())</span> 
           <span class="p">{</span>   
             <span class="k">using</span> <span class="p">(</span><span class="n">DbDataReader</span> <span class="n">rdr</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteReader</span><span class="p">())</span> 
              <span class="p">{</span>        
               <span class="c1">// Reading Logic        
</span>              <span class="p">}</span>        
             <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>         
             <span class="c1">//itd     
</span>           <span class="p">}</span> 
    <span class="p">}</span></code></pre>
          </figure>

          <p>GetFactory methods decides on which provider to return back based on the parameter in Connection String. Provider creates his specific Connection and Command.</p>

          <p>We are not using concrete classes like SQLConnection or SQLcommand everything is wrapped on more  general objects  DBConnection and DBCommand .</p>

          <p><a href="http://lammichalfranc.files.wordpress.com/2010/03/provider-factory.jpg"><img class="aligncenter" title="provider factory" src="http://lammichalfranc.files.wordpress.com/2010/03/provider-factory.jpg" alt="" width="450" height="385" /></a></p>

          <p>After brief presentation i would like to to show you how to connect to DB engine. I want to create DB logic for “pools”.</p>

          <p>Let’s Do It !:</p>

          <p>In this case. I have implemented only Database logic . BlogEngine also supports XML files as a data source . To attach DB logic for our objects i have created 2 partial classes. One of them extends DbBlogProvider  class ,which contains communication logic. The BlogProvider ,class is defines common interface for both the xml and db data storing concept . This is the another abstraction layer by which we can attach differetn db data storing procedures without significant change in the existing code .</p>

          <p><a href="http://lammichalfranc.files.wordpress.com/2010/03/roznci-dbproviderzy1.jpg"><img class="aligncenter" title="Roznci DbProviderzy" src="http://lammichalfranc.files.wordpress.com/2010/03/roznci-dbproviderzy1.jpg" alt="" width="450" height="326" /></a></p>

          <p>I just had to extend the partial class with my own methods.</p>

          <figure class="highlight">
            <pre><code class="language-csharp" data-lang="csharp"><span class="k">namespace</span> <span class="nn">BlogEngine.Core.Providers</span> 
<span class="p">{</span>
 <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">DbBlogProvider</span><span class="p">:</span> <span class="n">BlogProvider</span> 
    <span class="p">{</span> 
      <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">CheckPoll</span><span class="p">(</span><span class="n">Poll</span> <span class="n">poll</span><span class="p">)</span> 
        <span class="p">{</span> 
          <span class="c1">//concrete logic
</span>         <span class="p">}</span> 
      <span class="p">...</span> 
    <span class="p">}</span> 
<span class="p">}</span></code></pre>
          </figure>

          <p>After this step we  just have to use the provider mechanism in BlogEngine.</p>

          <figure class="highlight">
            <pre><code class="language-csharp" data-lang="csharp"><span class="n">_provider</span> <span class="p">=</span> <span class="n">BlogEngine</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">Providers</span><span class="p">.</span><span class="n">BlogService</span><span class="p">.</span><span class="n">Provider</span><span class="p">;</span>

<span class="n">_provider</span><span class="p">.</span><span class="nf">CheckPoll</span><span class="p">(</span><span class="n">poll</span><span class="p">);</span></code></pre>
          </figure>

          <p>&lt;/div&gt;</p>
        </blockquote>
      </address>
    </address>
  </blockquote>
</div>

      <span id="post-end"></span>
    </div>

    <div id="mc_embed_signup">
<form action="https://mfranc.us13.list-manage.com/subscribe/post?u=8a5865e28c59044d419ecbe95&amp;id=d545f31150" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">If you are interested in Cloud Native, Scalability, System Design and more meaty side of Engineering at Scale. Then subscribe to my mailing list.</label>
      <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8a5865e28c59044d419ecbe95_d545f31150" tabindex="-1" value=""></div>
        <div class="clear">
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
        </div>
    </div>
</form>
</div>



    
<hr>

<aside id="comments" class="disqus">
  <div class="container">
    <h3><i class="icon icon-comments-o"></i> Comments</h3>
    <div id="disqus_thread"></div>
    <script>
      (function() {
        var d = document,
        s = d.createElement('script');
        s.src = '//thesilenceofthelams.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</aside>



  </div>

</article>

      </div>


      <footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="http://github.com/michal-franc" target="_blank"><i class="icon icon-github"></i></a></li>
  <li><a href="http://twitter.com/francmichal" target="_blank"><i class="icon icon-twitter"></i></a></li>
  <li><a href="http://facebook.com/michalfrancblog" target="_blank"><i class="icon icon-facebook"></i></a></li>
  <li><a href="https://uk.linkedin.com/in/michalfranc1" target="_blank"><i class="icon icon-linkedin"></i></a></li>
</ul>

    <p class="txt-medium-gray">
      <small>&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


      <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.slick-modals.js"/></script>

	  <!-- <script id="ulp-remote" src="http://tools.mfranc.com/wp-content/plugins/layered-popups/js/remote.min.js?ver=5.89" data-handler="http://tools.mfranc.com/wp-admin/admin-ajax.php"></script>
	  <script>

		    (function ($) {
			"use strict";
			var objectPositionTop = $('#post-end').offset().top - window.innerHeight;

				ulp_add_event("onexit", {
					popup:		"4AXWiVSrZD71uqiP",
					mode:		"once-period",
					period:		30
				});

				ulp_add_event("onidle", {
					popup:		"85oltSbndJGZQzaW",
					mode:		"once-period",
					period:         30
				});

				ulp_add_event("onscroll", {
					popup:		"INyhHrwTzxjvcqEb",
					mode:		"once-period",
					period:         30,
					offset:		objectPositionTop / 2
				});

		    }(jQuery));

    </script> -->

		<script id="dsq-count-scr" src="//thesilenceofthelams.disqus.com/count.js" async></script>

		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.7&appId=125980610784627";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
    </main>
  </body>
</html>

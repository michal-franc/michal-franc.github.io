<!DOCTYPE html>
<html>
    <head>

    
    <meta name="robots" content="all">
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Michal Franc">
    <meta name="keywords" content="michal franc,leader,programmer,coach,speaker">
	<title>Generics and Object Casting– Boxing , Unboxing | Michal Franc</title>
	<meta name="description" content="There are multiple scenarios in which we need to create generic classes for different objects. In this case we have two options. Either we can create generic...">

    <link href="https://fonts.googleapis.com/css?family=Inconsolata:700|Raleway" rel="stylesheet">
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="author" href="https://plus.google.com/104238159697387202725?rel=author">

	<link rel="canonical" href="http://www.mfranc.com/blog/generics-and-object-casting-boxing-unboxing/">

    <link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" type="text/css" href="/css/sm.css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Michal Franc | Feed" href="http://feeds.feedburner.com/PassionateProgram">

    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="Generics and Object Casting– Boxing , Unboxing | Michal Franc">
    <meta property="og:description" content="There are multiple scenarios in which we need to create generic classes for different objects. In this case we have two options. Either we can create generic...">
	<meta property="og:url" content="http://www.mfranc.com/blog/generics-and-object-casting-boxing-unboxing/">
    <meta property="og:site_name" content="Michal Franc Blog">
    <meta property="og:type" content="website">
	<meta property="og:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

	<meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Generics and Object Casting– Boxing , Unboxing | Michal Franc">
    <meta name="twitter:site" content="@francmichal">
    <meta name="twitter:creator" content="@francmichal">
    <meta name="twitter:description" content="There are multiple scenarios in which we need to create generic classes for different objects. In this case we have two options. Either we can create generic...">
	<meta name="twitter:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-15894596-3', 'auto');
  ga('send', 'pageview');
</script>

    <script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100563098); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100563098ns.gif" /></p></noscript>

    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

    <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1817837425153843'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1817837425153843&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->


  </head>


  <body>
    <main>
      <header class="site-header">
  <div class="container">
	  <h1><a href="/">Michal<span>Franc</span></a></h1>

    <button type="button" class="sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="navbar sliding-panel-content">
      <ul>
        
          <li><a href="/blog" title="Posts">Posts</a></li>
        
          <li><a href="/notes" title="Notes">Notes</a></li>
        
          <li><a href="/articles" title="Articles">Articles</a></li>
        
          <li><a href="/about" title="About">About</a></li>
        
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="sliding-panel-fade-screen"></div>


      <div class="container">
        <article role="article" class="post">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">Generics and Object Casting– Boxing , Unboxing</h1>
      <p class="post-meta">Mar 20, 2011 • Michal Franc - 
		<small>
			<i class="icon icon-comments"></i><span class="disqus-comment-count" data-disqus-url="http://mfranc.com/blog/generics-and-object-casting-boxing-unboxing/"></span>
		</small>
		<small>
			
		</small>
	  </p>
    </header>

	<center>
		
	</center>

    <div class="post-content">
      
      <p align="justify">There are multiple scenarios in which we need to create generic classes for different objects. In this case we have two options. Either we can create generic class and specify the type/types of the object in the code  or ,  we can create a class operating on the System.Object types which are the base for every object / class in the framework.</p>
<p align="justify">If we have two options available then  the question is which one is better ?</p>
<p align="justify">To test both approaches , I created a simple logic which performs assignment and some kind of operation which returns value. This logic is encapsulated in two classes. <strong>ClassGeneric</strong> is built with generics built in .Net .You can see that type is represented by <strong>“U”</strong> letter. <strong>ClassObject</strong> is based on casting to System.Object.</p>
<p align="justify"></p>

<h2 align="justify"><span>Code</span>:</h2>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp">   <span class="k">class</span> <span class="nc">ClassGeneric</span><span class="p">&lt;</span><span class="n">U</span><span class="p">&gt;</span> 
    <span class="p">{</span> 
        <span class="n">U</span> <span class="n">test</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">ClassGeneric</span><span class="p">(</span><span class="n">U</span> <span class="k">value</span><span class="p">)</span> 
        <span class="p">{</span> 
            <span class="n">test</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> 
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Operation</span><span class="p">()</span> 
        <span class="p">{</span> 
            <span class="n">U</span> <span class="n">t</span> <span class="p">=</span> <span class="n">test</span><span class="p">;</span> 
        <span class="p">}</span> 
    <span class="p">}</span>

    <span class="k">class</span> <span class="nc">ClassObject</span> 
    <span class="p">{</span> 
        <span class="n">Object</span> <span class="n">test</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">ClassObject</span><span class="p">(</span><span class="n">Object</span> <span class="k">value</span><span class="p">)</span> 
        <span class="p">{</span> 
            <span class="n">test</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> 
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Operation</span><span class="p">()</span> 
        <span class="p">{</span> 
            <span class="kt">int</span> <span class="n">t</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">test</span><span class="p">;</span> 
        <span class="p">}</span> 
    <span class="p">}</span></code></pre>
</figure>

<h2 align="justify"><span>Test </span>:</h2>
<p align="justify">Now lets perform a simple test by creating instances of both classes and performing operation. Stopwatch will be used to check performance.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp">       <span class="k">static</span> <span class="n">Stopwatch</span> <span class="n">sw</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Stopwatch</span><span class="p">();</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> 
        <span class="p">{</span> 
            <span class="n">sw</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span> 
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10000000</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> 
            <span class="p">{</span> 
                <span class="k">new</span> <span class="n">Labs</span><span class="p">.</span><span class="n">ClassGeneric</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="m">1</span><span class="p">).</span><span class="nf">Operation</span><span class="p">();</span> 
            <span class="p">}</span> 
            <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">);</span>

            <span class="n">sw</span><span class="p">.</span><span class="nf">Reset</span><span class="p">();</span> 
            <span class="n">sw</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span> 
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10000000</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> 
            <span class="p">{</span> 
                <span class="k">new</span> <span class="n">Labs</span><span class="p">.</span><span class="nf">ClassObject</span><span class="p">((</span><span class="kt">object</span><span class="p">)</span><span class="m">1</span><span class="p">).</span><span class="nf">Operation</span><span class="p">();</span> 
            <span class="p">}</span> 
            <span class="n">sw</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">);</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span> 
        <span class="p">}</span></code></pre>
</figure>

<p> </p>
<h2 align="justify"><span>Result </span>:</h2>
<p align="justify"><span><strong>Generics 471k</strong> ticks  <strong>-  Objects  710k</strong> ticks</span></p>
<p align="justify"><span><strong>Generics 212</strong> ms  <strong>-</strong>  <strong>Objects 343</strong> ms</span></p>
<p align="justify"></p>

<h2 align="justify"><span>Why there is a difference ?</span></h2>
<p align="justify">Generics are defined on the runtime.  .Net Framework based on the specified type in the code for example  (Queue<int>) creates a class with the type and stores reference to it. This operation is performed once on the start by the JIT-er (Just in time compiler). This operation is performed once so there is a minimal performance loss.</int></p>
<p align="justify">In case of System.Object class when casting from and to int we are performing <strong>Boxing</strong> and <strong>Unboxing</strong> operation.</p>
<p align="justify">Boxing is performed every time we are casting Value Type to the reference Type. Boxing operation wraps our Value Type in a class deriving from the System.Object. This operation requires some cpu work. Same thing applies for the Unboxing operation which is performed when casting from Reference Type to the Value Type.</p>
<p align="justify">In this example I am casting int to Object type 1000000 times. This is the cause of the difference in time / performance. Generic classes does not require additional operations.</p>

<h2 align="justify"><span>Boxing , Unboxing and generic interfaces</span></h2>
<p align="justify">Understaing when your code perfmors boxing and unboxing is  really important. Check this example. In .Net we can implement various interfaces which are used in the Framework. Some of them are generic. We can define which type will be used.</p>
<p align="justify">Here I am implementing IComparable interface , which is usefull when you want to perform Sort operation on the Collection containing your custom Class.</p>
<p align="justify">First Class uses the Generic Interface.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp">    <span class="k">class</span> <span class="nc">ClassSort</span> <span class="p">:</span> <span class="n">IComparable</span><span class="p">&lt;</span><span class="n">ClassSort</span><span class="p">&gt;</span> 
    <span class="p">{</span> 
        <span class="k">public</span> <span class="kt">int</span> <span class="n">A</span> <span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>

        <span class="err">#</span><span class="n">region</span> <span class="n">IComparable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">Members</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="n">ClassSort</span> <span class="n">other</span><span class="p">)</span> 
        <span class="p">{</span> 
          <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span> 
        <span class="p">}</span>
        <span class="err">#</span><span class="n">endregion</span> 
    <span class="p">}</span></code></pre>
</figure>

<p align="justify">Second class uses default Interface.</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp">    <span class="k">class</span> <span class="nc">ClassSortOne</span> <span class="p">:</span> <span class="n">IComparable</span> 
    <span class="p">{</span> 
        <span class="k">public</span> <span class="kt">int</span> <span class="n">A</span> <span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>

        <span class="err">#</span><span class="n">region</span> <span class="n">IComparable</span> <span class="n">Members</span>

        <span class="k">public</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span> 
        <span class="p">{</span> 
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotImplementedException</span><span class="p">();</span> 
        <span class="p">}</span>

        <span class="err">#</span><span class="n">endregion</span> 
    <span class="p">}</span></code></pre>
</figure>

<p align="justify">As you can see IComparable without generic type forces boxing when comparing objects beacuase we have to cast the objects. CompareTo() method in example with default interface uses object as a parameter while generic interface implements method with specified class as a parameter. Interface with specified generic type doesn’t need boxing and it is faster.</p>
<p align="justify"></p>

<h2 align="justify"><span>Conclusion:</span></h2>
<p align="justify">Use generic classes as often as you can. Especially when making a lot of operations with them. Simple casting which causes boxing and unboxing process consumes a lot of processor time.</p>

      <span id="post-end"></span>
    </div>

    <div id="mc_embed_signup">
<form action="https://mfranc.us13.list-manage.com/subscribe/post?u=8a5865e28c59044d419ecbe95&amp;id=d545f31150" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">If you are interested in Cloud Native, Scalability, System Design and more meaty side of Engineering at Scale. Then subscribe to my mailing list.</label>
      <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8a5865e28c59044d419ecbe95_d545f31150" tabindex="-1" value=""></div>
        <div class="clear">
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
        </div>
    </div>
</form>
</div>



    
<hr>

<aside id="comments" class="disqus">
  <div class="container">
    <h3><i class="icon icon-comments-o"></i> Comments</h3>
    <div id="disqus_thread"></div>
    <script>
      (function() {
        var d = document,
        s = d.createElement('script');
        s.src = '//thesilenceofthelams.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</aside>



  </div>

</article>

      </div>


      <footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="http://github.com/michal-franc" target="_blank"><i class="icon icon-github"></i></a></li>
  <li><a href="http://twitter.com/francmichal" target="_blank"><i class="icon icon-twitter"></i></a></li>
  <li><a href="http://facebook.com/michalfrancblog" target="_blank"><i class="icon icon-facebook"></i></a></li>
  <li><a href="https://uk.linkedin.com/in/michalfranc1" target="_blank"><i class="icon icon-linkedin"></i></a></li>
</ul>

    <p class="txt-medium-gray">
      <small>&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


      <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.slick-modals.js"/></script>

	  <!-- <script id="ulp-remote" src="http://tools.mfranc.com/wp-content/plugins/layered-popups/js/remote.min.js?ver=5.89" data-handler="http://tools.mfranc.com/wp-admin/admin-ajax.php"></script>
	  <script>

		    (function ($) {
			"use strict";
			var objectPositionTop = $('#post-end').offset().top - window.innerHeight;

				ulp_add_event("onexit", {
					popup:		"4AXWiVSrZD71uqiP",
					mode:		"once-period",
					period:		30
				});

				ulp_add_event("onidle", {
					popup:		"85oltSbndJGZQzaW",
					mode:		"once-period",
					period:         30
				});

				ulp_add_event("onscroll", {
					popup:		"INyhHrwTzxjvcqEb",
					mode:		"once-period",
					period:         30,
					offset:		objectPositionTop / 2
				});

		    }(jQuery));

    </script> -->

		<script id="dsq-count-scr" src="//thesilenceofthelams.disqus.com/count.js" async></script>

		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.7&appId=125980610784627";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
    </main>
  </body>
</html>

<!DOCTYPE html>
<html>
    <head>

    
    <meta name="robots" content="all">
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Michal Franc">
    <meta name="keywords" content="michal franc,leader,programmer,coach,speaker">
	<title>Seam Carving (2) | Michal Franc</title>
	<meta name="description" content="Po dłuższej przerwie postanowiłem ostro wziąć się do roboty za algorytm skalowania obrazków. Jest już ładna formatka [szczyt ui designu] i parę opcji. Skalow...">

    <link href="https://fonts.googleapis.com/css?family=Inconsolata:700|Raleway" rel="stylesheet">
    <link rel="profile" href="http://gmpg.org/xfn/11">
    <link rel="author" href="https://plus.google.com/104238159697387202725?rel=author">

	<link rel="canonical" href="http://www.mfranc.com/blog/seam-carving-2/">

    <link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" type="text/css" href="/css/sm.css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Michal Franc | Feed" href="http://feeds.feedburner.com/PassionateProgram">

    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="Seam Carving (2) | Michal Franc">
    <meta property="og:description" content="Po dłuższej przerwie postanowiłem ostro wziąć się do roboty za algorytm skalowania obrazków. Jest już ładna formatka [szczyt ui designu] i parę opcji. Skalow...">
	<meta property="og:url" content="http://www.mfranc.com/blog/seam-carving-2/">
    <meta property="og:site_name" content="Michal Franc Blog">
    <meta property="og:type" content="website">
	<meta property="og:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

	<meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Seam Carving (2) | Michal Franc">
    <meta name="twitter:site" content="@francmichal">
    <meta name="twitter:creator" content="@francmichal">
    <meta name="twitter:description" content="Po dłuższej przerwie postanowiłem ostro wziąć się do roboty za algorytm skalowania obrazków. Jest już ładna formatka [szczyt ui designu] i parę opcji. Skalow...">
	<meta name="twitter:image" content="http://michal-franc.github.io/images/default_share_image.jpg">

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-15894596-3', 'auto');
  ga('send', 'pageview');
</script>

    <script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100563098); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100563098ns.gif" /></p></noscript>

    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

    <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1817837425153843'); // Insert your pixel ID here.
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1817837425153843&ev=PageView&noscript=1"
/></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->


  </head>


  <body>
    <main>
      <header class="site-header">
  <div class="container">
	  <h1><a href="/">Michal<span>Franc</span></a></h1>

    <button type="button" class="sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="navbar sliding-panel-content">
      <ul>
        
          <li><a href="/blog" title="Posts">Posts</a></li>
        
          <li><a href="/notes" title="Notes">Notes</a></li>
        
          <li><a href="/articles" title="Articles">Articles</a></li>
        
          <li><a href="/about" title="About">About</a></li>
        
        <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i></a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="sliding-panel-fade-screen"></div>


      <div class="container">
        <article role="article" class="post">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">Seam Carving (2)</h1>
      <p class="post-meta">Dec 1, 2009 • Michal Franc - 
		<small>
			<i class="icon icon-comments"></i><span class="disqus-comment-count" data-disqus-url="http://mfranc.com/blog/seam-carving-2/"></span>
		</small>
		<small>
			
		</small>
	  </p>
    </header>

	<center>
		
	</center>

    <div class="post-content">
      
      <p>Po dłuższej przerwie postanowiłem ostro wziąć się do roboty za algorytm skalowania obrazków. Jest już ładna formatka [szczyt ui designu] i parę opcji. Skalowanie statycznym seamem tzn po lini prostej i skalowanie dynamicznym seamem tzn wyszukiwanie najlepszej drogi. Wszystko jak na razie działa przy pionowym skalowaniu ale wkrótce zmontuje skalowanie poziome. Pierw muszę troszeczkę przeprojektować aplikację bo wdarł się lekki chaos do kodu i kod jest “be” a ja nie na widzę brzydkiego kodu :P</p>

<p>Przeprojektowałem znacznie aplikację , zrefaktoryzowałem kod dla lepszej czytelności i dorzuciłem interfejsy w celu zmniejszenia zależności pomiędzy klasami i wyeliminowania z duplikowanego kodu zgodnie z zasadą DRY = “Don’t repeat Yourself” ;]. Jeszcze jeden interfejs nie jest do końca dorobiony i przemyślany bo nie wiem jak pogodzić zabawę na wskaźnikach w klasie z modyfikatorem “unsafe” … coś wymyślę ;]</p>

<p>Aplikacja opiera się teraz na 2 interfejsach.</p>

<p style="margin:0;"><span style="color:yellow;">    9</span>     <span style="color:#ee6f11;">public</span> <span style="color:#ee6f11;">interface</span> <span style="color:#2b91af;">IImageProcessing</span></p>
<p style="margin:0;"><span style="color:yellow;">   10</span>     {</p>
<p style="margin:0;"><span style="color:yellow;">   11</span>         <span style="color:#ee6f11;">void</span> Open();</p>
<p style="margin:0;"><span style="color:yellow;">   12</span>         <span style="color:#ee6f11;">void</span> Close();</p>
<p style="margin:0;"><span style="color:yellow;">   13</span> </p>
<p style="margin:0;"><span style="color:yellow;">   14</span>         <span style="color:#ee6f11;">void</span> SetBmp(<span style="color:#2b91af;">Bitmap</span> bmp);</p>
<p style="margin:0;"><span style="color:yellow;">   15</span>         <span style="color:#2b91af;">Bitmap</span> GetBmp();</p>
<p style="margin:0;"><span style="color:yellow;">   16</span>         <span style="color:#ee6f11;">void</span> SaveBmp(<span style="color:#ee6f11;">string</span> fileLocation);</p>
<p style="margin:0;"><span style="color:yellow;">   17</span> </p>
<p style="margin:0;"><span style="color:yellow;">   18</span>         <span style="color:#ee6f11;">void</span> RemoveStaticRow(<span style="color:#ee6f11;">int</span> x);</p>
<p style="margin:0;"><span style="color:yellow;">   19</span>         <span style="color:#ee6f11;">void</span> RemoveDynamicRow(<span style="color:#ee6f11;">int</span>[] inTab);</p>
<p style="margin:0;"><span style="color:yellow;">   20</span>         <span style="color:#ee6f11;">void</span> MarkDynamicRow(<span style="color:#ee6f11;">int</span>[] inTab);</p>
<p style="margin:0;"><span style="color:yellow;">   21</span>         <span style="color:#ee6f11;">void</span> MarkStaticRow(<span style="color:#ee6f11;">int</span> x);</p>
<p style="margin:0;"><span style="color:yellow;">   22</span> </p>
<p style="margin:0;"><span style="color:yellow;">   23</span>         <span style="color:#ee6f11;">int</span>[,] Gradient(<span style="color:#ee6f11;">bool</span> saveBmp);</p>
<p style="margin:0;"><span style="color:yellow;">   24</span>     }</p>

<p><strong>IImageProcessing</strong> definiuje nasz silnik graficzny na którym będziemy operować i jego metody do obróbki obrazu.
W tym momencie mam jedną klasę implementująca ten interfejs GDIImageProces. Dzięki takiemu rozdzieleniu interfejsów od implementacji Klasa SeamCarving nie zastanawia się nad tym co się dzieje przy obróbce obrazu i mogę łatwo podmienić silnik graficzni np na wolniejszy korzystający z metod GetPixel SetPixel. Wystarczy ze stworzę nową klasę i zaimplementuje odpowiednie metody interfejsu IImageProcessing. Jest to bodajże pewna implementacja wzorca <a href="http://en.wikipedia.org/wiki/Strategy_pattern"><strong>Strategia “Policy”.</strong></a></p>

<p style="margin:0;"><span style="color:yellow;">   10</span>     <span style="color:#ee6f11;">public</span> <span style="color:#ee6f11;">interface</span> <span style="color:#2b91af;">IManipulator</span></p>
<p style="margin:0;"><span style="color:yellow;">   11</span>     {</p>
<p style="margin:0;"><span style="color:yellow;">   12</span>         <span style="color:#ee6f11;">void</span> ManipulateSeam(<span style="color:#2b91af;">IImageProcessing</span> imgProcessor);</p>
<p style="margin:0;"><span style="color:yellow;">   13</span>     }</p>

<p><strong>IManipulator</strong> definiuje algorytmy przetwarzania Seamow wyszcególniam 4 rodzaje tych algorytmów:
- Statyczne usuwanie Seama bez zaznaczania czerwoną kreską
- Statyczne usuwanie Seama z zaznaczaniem
- Dynamicznie usuwanie bez zaznaczania
- Dynamicznie usuwanie z zaznaczaniem</p>

<p>W tym momencie rozdzielone mam 2 metody wyjściowe jedną przyjmująca obiekt implementujący IManipulatora z zaznaczaniem i drugą bez zaznazczania. Wkrótce postaram się znaleźć jakieś lepsze rozwiązanie by była jedna metoda. A nie 2 przyjmujące podobny obiekt. Wprowadza to pewne “confusion” dla usera który nie do końca wie jak z tych metod skorzystać. Jest to spowodowane tym że musiałem zastosować śmieszne obejście błedu w GDI+ poprzez dwukrotne clonowanie bitmap.</p>

<p style="margin:0;"><span style="color:yellow;">   82</span>             <span style="color:#2b91af;">Bitmap</span> tmp = (<span style="color:#2b91af;">Bitmap</span>)_imgProcessor.GetBmp().Clone();</p>
<p style="margin:0;"><span style="color:yellow;">   83</span> </p>
<p style="margin:0;"><span style="color:yellow;">   84</span>             SeamManipulation(seamManipulator, numberOfOper);</p>
<p style="margin:0;"><span style="color:yellow;">   85</span> </p>
<p style="margin:0;"><span style="color:yellow;">   86</span>             <span style="color:#2b91af;">Bitmap</span> tmp1 = (<span style="color:#2b91af;">Bitmap</span>)_imgProcessor.GetBmp().Clone();</p>
<p style="margin:0;"><span style="color:yellow;">   87</span>             _imgProcessor.SetBmp(tmp);</p>

<p>Znalazłem na razie zastępczą metodę dla kolorowania składni. Add-in do visuala <strong><a href="http://copysourceashtml.codeplex.com">Copy Source As Html&lt;/strong&gt;</a></strong></p>

<p><a href="http://lammichalfranc.files.wordpress.com/2009/12/dynamicseam.jpg"><img src="http://lammichalfranc.files.wordpress.com/2009/12/dynamicseam.jpg" alt="" title="dynamicSeam" width="450" height="539" class="aligncenter size-full wp-image-148" /></a>
Dynamiczny Seam</p>

<p><a href="http://lammichalfranc.files.wordpress.com/2009/12/seamcarvingdynamic100.jpg"><img class="aligncenter size-full wp-image-147" title="seamcarvingdynamic100" src="http://lammichalfranc.files.wordpress.com/2009/12/seamcarvingdynamic100.jpg" alt="" width="343" height="583" /></a></p>

<p>Rysunek po obróbce 150+ seamów.</p>

<p>Wrzuciłem kod źródłowy wersji “alpha” do działu <a href="http://lammichalfranc.wordpress.com/pliki/"><strong> Projekciki </strong></a>. Podaje tam także linka do mojego repozytorium Svn-owego. Proszę się nie śmiać z komentarzy :]</p>

      <span id="post-end"></span>
    </div>

    <div id="mc_embed_signup">
<form action="https://mfranc.us13.list-manage.com/subscribe/post?u=8a5865e28c59044d419ecbe95&amp;id=d545f31150" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <label for="mce-EMAIL">If you are interested in Cloud Native, Scalability, System Design and more meaty side of Engineering at Scale. Then subscribe to my mailing list.</label>
      <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8a5865e28c59044d419ecbe95_d545f31150" tabindex="-1" value=""></div>
        <div class="clear">
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
        </div>
    </div>
</form>
</div>



    
<hr>

<aside id="comments" class="disqus">
  <div class="container">
    <h3><i class="icon icon-comments-o"></i> Comments</h3>
    <div id="disqus_thread"></div>
    <script>
      (function() {
        var d = document,
        s = d.createElement('script');
        s.src = '//thesilenceofthelams.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</aside>



  </div>

</article>

      </div>


      <footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="http://github.com/michal-franc" target="_blank"><i class="icon icon-github"></i></a></li>
  <li><a href="http://twitter.com/francmichal" target="_blank"><i class="icon icon-twitter"></i></a></li>
  <li><a href="http://facebook.com/michalfrancblog" target="_blank"><i class="icon icon-facebook"></i></a></li>
  <li><a href="https://uk.linkedin.com/in/michalfranc1" target="_blank"><i class="icon icon-linkedin"></i></a></li>
</ul>

    <p class="txt-medium-gray">
      <small>&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


      <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	  <script type="text/javascript" src="/js/jquery.slick-modals.js"/></script>

	  <!-- <script id="ulp-remote" src="http://tools.mfranc.com/wp-content/plugins/layered-popups/js/remote.min.js?ver=5.89" data-handler="http://tools.mfranc.com/wp-admin/admin-ajax.php"></script>
	  <script>

		    (function ($) {
			"use strict";
			var objectPositionTop = $('#post-end').offset().top - window.innerHeight;

				ulp_add_event("onexit", {
					popup:		"4AXWiVSrZD71uqiP",
					mode:		"once-period",
					period:		30
				});

				ulp_add_event("onidle", {
					popup:		"85oltSbndJGZQzaW",
					mode:		"once-period",
					period:         30
				});

				ulp_add_event("onscroll", {
					popup:		"INyhHrwTzxjvcqEb",
					mode:		"once-period",
					period:         30,
					offset:		objectPositionTop / 2
				});

		    }(jQuery));

    </script> -->

		<script id="dsq-count-scr" src="//thesilenceofthelams.disqus.com/count.js" async></script>

		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.7&appId=125980610784627";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
    </main>
  </body>
</html>
